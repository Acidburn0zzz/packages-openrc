# Maintainer: udeved <udeved@openrc4arch.site40.net>

pkgbase=openrc-fs
pkgname=openrc-fs
true && pkgname=('cryptsetup-openrc' 'device-mapper-openrc' 'lvm2-openrc' 'mdadm-openrc' 'nfs-utils-openrc' 'quota-tools-openrc' 'samba-openrc')
pkgver=20131016
pkgrel=1
pkgdesc="OpenRC init scripts"
arch=('any')
url="http://openrc4arch.site40.net"
license=('GPL2')
groups=('openrc-fs')
makedepends=('cryptsetup' 'device-mapper' 'lvm2' 'mdadm' 'nfs-utils' 'quota-tools' 'samba')
conflicts=('openrc-arch-services-git')

_gentoo_uri="http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86"

source=("${_gentoo_uri}/sys-fs/cryptsetup/files/1.0.6-dmcrypt.confd"
	"${_gentoo_uri}/sys-fs/cryptsetup/files/1.5.1-dmcrypt.rc"
	"${_gentoo_uri}/sys-fs/lvm2/files/device-mapper.conf-1.02.22-r3"
	"${_gentoo_uri}/sys-fs/lvm2/files/device-mapper.rc-2.02.95-r2"
	"${_gentoo_uri}/sys-fs/lvm2/files/dmeventd.initd-2.02.67-r1"
	"${_gentoo_uri}/sys-fs/lvm2/files/lvm.confd-2.02.28-r2"
	"${_gentoo_uri}/sys-fs/lvm2/files/lvm.rc-2.02.95-r2"
	"${_gentoo_uri}/sys-fs/lvm2/files/lvm-monitoring.initd-2.02.67-r2"
	"${_gentoo_uri}/sys-fs/mdadm/files/mdadm.confd"
	"${_gentoo_uri}/sys-fs/mdadm/files/mdadm.rc"
	"${_gentoo_uri}/net-fs/nfs-utils/files/nfs.confd"
	"${_gentoo_uri}/net-fs/nfs-utils/files/nfs.initd"
	"${_gentoo_uri}/net-fs/nfs-utils/files/nfsmount.initd"
	"${_gentoo_uri}/net-fs/nfs-utils/files/rpc.gssd.initd"
	"${_gentoo_uri}/net-fs/nfs-utils/files/rpc.idmapd.initd"
	"${_gentoo_uri}/net-fs/nfs-utils/files/rpc.pipefs.initd"
	"${_gentoo_uri}/net-fs/nfs-utils/files/rpc.statd.initd"
	"${_gentoo_uri}/net-fs/nfs-utils/files/rpc.svcgssd.initd"
	"${_gentoo_uri}/sys-fs/quota/files/quota.confd"
	"${_gentoo_uri}/sys-fs/quota/files/quota.rc7"
	"${_gentoo_uri}/sys-fs/quota/files/rpc.rquotad.initd"
	"${_gentoo_uri}/net-fs/samba/files/4.0/samba4.confd"
	"${_gentoo_uri}/net-fs/samba/files/4.0/samba4.initd-r1")

sha256sums=('0c30e081c0b8f879964ae49735f10b05a1d92f4f481042851958860945e13271'
            '02faf27470ea0e50b764c923786724847e77dfdf9680a50cc202546cad2bf02f'
            '57777904f12a35617e5a4193c964ebb32396452487fd02353e71e16e7b46bc22'
            'e0bff689040746480e2479d1ad57adb5ab23cc0415ab9a8356503aed7a14c658'
            'dbf81d357446fa555bcd75939af6d5982c10a8235800ddc299d2673b2c694d39'
            '28370c089c39c248d7ded0960b8d8a9256bada44d44c22ce3cec87d512ef6844'
            '66844a70cedf61b2cd3373cdbd8f8c1afa817bde0764fdf5cf488857532d4553'
            'b89971a4f163e1a91df2416ff442cae7209f8343e6c8612eb3174ed8f5c5c788'
            'ec55674955af7a31da51b8b72b599e8519809287dad796a9b16155bcba471b79'
            '3073b14619cb7b2c99c33f2d6cfd1e59ce5557899bffebaa65fa52f3caffadc7'
            '22bba4ee5d58bae422650875c7c8a797a52fc121ddd02d48297c075b8a35401e'
            '8df22f253770a24c6a53ce332d821ab680d0ede18d0e968c1c5d8b3796cb74be'
            'b57637c7eb8e40b5cc1655e8afa69dc0aaecbd3186bdca3301586d1e9b797357'
            '00d9c29280a83e8458c33139d04a9b38c6fdba9d7cb9b420ca83bf6b10e6435d'
            '3ce65326859c43983dad25ad2d4731488c488037796e39b6b5eda336e8bf81ef'
            '6503951b3c200ccf3f46396f7b9274f0a565807f7f6e561c17bed6b0133ae49a'
            '0c7bd35a14da6c0c2577f09ae82a41ddb693a88157eeaf80684616f79be6c304'
            'f1c460d8b0e91e54a551397d755135d05a3728d81de596535bf8bda074455677'
            '00d1dfb3b893db5d6a213a4edda622c7d64dcafa40b3019f15e070c164286632'
            '00ce705b49aaa356d9d9f0be3b80a3fe2810471cbe02fd0edc66349f3ca281de'
            'c3896303d6cfebf314a3f6b8aeed0f6cb6ae421c4c0923b0121c76b3251314e5'
            '53755809cc27fdbaf98752cd3da45b5c2bda62dd46fcc37570c6e237f7954ffa'
            '4d00243dbd85ee81e2e989f1ac8035c1c1b9379133584291b959bb7bc45fe780')

pkgver() {
  date +%Y%m%d
}

package_cryptsetup-openrc() {
	true
	pkgdesc="OpenRC cryptsetup init script"
	depends=('openrc' 'cryptsetup')
	install=cryptsetup.install

	install -Dm755 "${srcdir}/1.0.6-dmcrypt.confd" "${pkgdir}/etc/conf.d/dmcrypt"
	install -Dm755 "${srcdir}/1.5.1-dmcrypt.rc" "${pkgdir}/etc/init.d/dmcrypt"

	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -i ${pkgdir}/etc/init.d/dmcrypt
}

package_device-mapper-openrc() {
	true
	pkgdesc="OpenRC device-mapper init script"
	depends=('openrc' 'device-mapper')
	install=device-mapper.install

	install -Dm755 "${srcdir}/device-mapper.conf-1.02.22-r3" "${pkgdir}/etc/conf.d/device-mapper"
	install -Dm755 "${srcdir}/device-mapper.rc-2.02.95-r2" "${pkgdir}/etc/init.d/device-mapper"
	install -Dm755 "${srcdir}/dmeventd.initd-2.02.67-r1" "${pkgdir}/etc/init.d/dmeventd"

	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -i ${pkgdir}/etc/init.d/device-mapper
	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -i ${pkgdir}/etc/init.d/dmeventd
}

package_lvm2-openrc() {
	true
	pkgdesc="OpenRC lvm2 init script"
	depends=('openrc' 'lvm2' 'device-mapper-openrc')
	install=lvm2.install

	install -Dm755 "${srcdir}/lvm.confd-2.02.28-r2" "${pkgdir}/etc/conf.d/lvm"
	install -Dm755 "${srcdir}/lvm.rc-2.02.95-r2" "${pkgdir}/etc/init.d/lvm"
	install -Dm755 "${srcdir}/lvm-monitoring.initd-2.02.67-r2" "${pkgdir}/etc/init.d/lvm-monitoring"

	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -i ${pkgdir}/etc/init.d/lvm
	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -i ${pkgdir}/etc/init.d/lvm-monitoring

}

package_mdadm-openrc() {
	true
	pkgdesc="OpenRC mdadm init script"
	depends=('openrc' 'mdadm')
	optdepends=('bind-openrc')
	install=mdadm.install

	install -Dm755 "${srcdir}/mdadm.confd" "${pkgdir}/etc/conf.d/mdadm"
	install -Dm755 "${srcdir}/mdadm.rc" "${pkgdir}/etc/init.d/mdadm"

	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/var/run|/run|g' -i ${pkgdir}/etc/init.d/mdadm
}

package_nfs-utils-openrc() {
	true
	pkgdesc="OpenRC nfs-utils init script"
	depends=('openrc' 'nfs-utils' 'rpcbind-openrc' 'device-mapper-openrc')
	optdepends=('ypbind-openrc' 'quota-tools-openrc' 'bind-openrc')
	install=nfs-utils.install

	install -Dm755 "${srcdir}/nfs.confd" "${pkgdir}/etc/conf.d/nfs-rc"
	install -Dm755 "${srcdir}/nfs.initd" "${pkgdir}/etc/init.d/nfs"
	install -Dm755 "${srcdir}/nfsmount.initd" "${pkgdir}/etc/init.d/nfsmount"
	install -Dm755 "${srcdir}/rpc.gssd.initd" "${pkgdir}/etc/init.d/rpc.gssd"
	install -Dm755 "${srcdir}/rpc.idmapd.initd" "${pkgdir}/etc/init.d/rpc.idmapd"
	install -Dm755 "${srcdir}/rpc.pipefs.initd" "${pkgdir}/etc/init.d/rpc.pipefs"
	install -Dm755 "${srcdir}/rpc.statd.initd" "${pkgdir}/etc/init.d/rpc.statd"
	install -Dm755 "${srcdir}/rpc.svcgssd.initd" "${pkgdir}/etc/init.d/rpc.svcgssd"

	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -e 's|/etc/conf.d/nfs|/etc/conf.d/nfs-rc|g' -i "${pkgdir}/etc/init.d/nfs"
	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -e 's|/etc/conf.d/nfs|/etc/conf.d/nfs-rc|g' -i "${pkgdir}/etc/init.d/nfsmount"
	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -e 's|/etc/conf.d/nfs|/etc/conf.d/nfs-rc|g' -i "${pkgdir}/etc/init.d/rpc.gssd"
	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -e 's|/etc/conf.d/nfs|/etc/conf.d/nfs-rc|g' -i "${pkgdir}/etc/init.d/rpc.idmapd"
	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -e 's|/etc/conf.d/nfs|/etc/conf.d/nfs-rc|g' -i "${pkgdir}/etc/init.d/rpc.pipefs"
	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -e 's|/etc/conf.d/nfs|/etc/conf.d/nfs-rc|g' -i "${pkgdir}/etc/init.d/rpc.statd"
	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -e 's|/etc/conf.d/nfs|/etc/conf.d/nfs-rc|g' -i "${pkgdir}/etc/init.d/rpc.svcgssd"
}

package_quota-tools-openrc() {
	true
	pkgdesc="OpenRC quota-tools init script"
	depends=('openrc' 'quota-tools' 'rpcbind-openrc')
	optdepends=('ypbind-openrc')
	install=quota-tools.install

	install -Dm755 "${srcdir}/quota.confd" "${pkgdir}/etc/conf.d/quota"
	install -Dm755 "${srcdir}/quota.rc7" "${pkgdir}/etc/init.d/quota"
	install -Dm755 "${srcdir}/rpc.rquotad.initd" "${pkgdir}/etc/init.d/rpc.rquotad"

	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -i "${pkgdir}/etc/init.d/quota"
	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -i "${pkgdir}/etc/init.d/rpc.rquotad"
}

package_samba-openrc() {
	true
	pkgdesc="OpenRC samba init script"
	depends=('openrc' 'samba')
	install=samba.install

	install -Dm755 "${srcdir}/samba4.confd" "${pkgdir}/etc/conf.d/samba-rc"
	install -Dm755 "${srcdir}/samba4.initd-r1" "${pkgdir}/etc/init.d/samba-rc"

	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -e 's|SVCNAME##samba|SVCNAME##samba-rc|g' -e 's|"samba"|"samba-rc"|g' "${pkgdir}/etc/conf.d/samba-rc"
	sed -e 's|#!/sbin/runscript|#!/usr/bin/runscript|' -e 's|/usr/sbin|/usr/bin|g' -e 's|/var/run|/run|g' -e 's|SVCNAME##samba|SVCNAME##samba-rc|g' -e 's|"samba"|"samba-rc"|g' "${pkgdir}/etc/init.d/samba-rc"
}