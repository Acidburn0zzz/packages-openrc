# Maintainer: udeved <udeved@openrc4arch.site40.net>

# file vars for easy update
_Ifrcon=fcron.init.3
_Crsysl=rsyslog.confd
_Irsysl=rsyslog.initd
_Csane=saned.confd
_Isane=saned.initd
_Ifuse=fuse.init
_Cmeta=metalog.confd
_Imeta=metalog.initd
_Csyslog=syslog-ng.confd
_Isyslog=syslog-ng.rc6
_Clirc1=lircd.conf.4
_Clirc2=irexec-confd
_Ilirc1=lircd-0.8.6-r2
_Ilirc2=irexec-initd-0.8.6-r2
_Ilirc3=lircmd
#_Csens=sensord-conf.d
_Isens1=sensord-4-init.d
_Isens2=fancontrol-init.d-2
_Isens3=lm_sensors-3-init.d
_Ccpu=conf.d-r2
_Icpu=init.d-r4
_Cntp1=ntpd.confd
_Cntp2=ntp-client.confd
_Cntp3=sntp.confd
_Intp1=ntpd.rc
_Intp2=ntp-client.rc
_Intp3=sntp.rc
_Icups=cupsd.init.d-r1
_Ccon=connman.confd
_Icon=connman.initd2

_gentoo_uri="http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86"

pkgbase=openrc-misc
pkgname=openrc-misc
true && pkgname=('cpupower-openrc'
		'connman-openrc'
		'fcron-openrc'
		'fuse-openrc'
		'metalog-openrc'
		'rsyslog-openrc'
		'sane-openrc'
		'syslog-ng-openrc'
		'lirc-utils-openrc'
		'lm_sensors-openrc'
		'ntp-openrc'
		'cups-openrc'
		'openrc-misc')
pkgver=20140522
pkgrel=1
pkgdesc="OpenRC init scripts"
arch=('any')
url="https://github.com/udeved/pkgbuilds"
license=('GPL2')
groups=('openrc' 'openrc-misc')
makedepends=('cups' 
	    'connman'
	    'dbus-openrc'
	    'fcron'
	    'fuse'
	    'lirc-utils'
	    'rsyslog'
	    'sane'
	    'syslog-ng')
conflicts=('openrc'
	'openrc-git'
	'openrc-arch-services-git'
	'initscripts'
	'systemd-sysvcompat')

source=("${_gentoo_uri}/sys-process/fcron/files/${_Ifrcon}"
	"${_gentoo_uri}/app-admin/rsyslog/files/7-stable/${_Crsysl}"
	"${_gentoo_uri}/app-admin/rsyslog/files/7-stable/${_Irsysl}"
	"${_gentoo_uri}/media-gfx/sane-backends/files/${_Csane}"
	"${_gentoo_uri}/media-gfx/sane-backends/files/${_Isane}"
	"${_gentoo_uri}/sys-fs/fuse/files/${_Ifuse}"
	"${_gentoo_uri}/app-admin/metalog/files/${_Cmeta}"
	"${_gentoo_uri}/app-admin/metalog/files/${_Imeta}"
	"${_gentoo_uri}/app-admin/syslog-ng/files/3.5/${_Csyslog}"
	"${_gentoo_uri}/app-admin/syslog-ng/files/3.5/${_Isyslog}"
	"${_gentoo_uri}/app-misc/lirc/files/${_Clirc1}"
	"${_gentoo_uri}/app-misc/lirc/files/${_Clirc2}"
	"${_gentoo_uri}/app-misc/lirc/files/${_Ilirc1}"
	"${_gentoo_uri}/app-misc/lirc/files/${_Ilirc2}"
	"${_gentoo_uri}/app-misc/lirc/files/${_Ilirc3}"
	"${_gentoo_uri}/sys-power/cpupower/files/${_Ccpu}"
	"${_gentoo_uri}/sys-power/cpupower/files/${_Icpu}"
	#"${_gentoo_uri}/sys-apps/lm_sensors/files/${_Csens}"
	"${_gentoo_uri}/sys-apps/lm_sensors/files/${_Isens1}"
	"${_gentoo_uri}/sys-apps/lm_sensors/files/${_Isens2}"
	"${_gentoo_uri}/sys-apps/lm_sensors/files/${_Isens3}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Cntp1}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Cntp2}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Cntp3}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Intp1}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Intp2}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Intp3}"
	"${_gentoo_uri}/net-print/cups/files/${_Icups}"
	"${_gentoo_uri}/net-misc/connman/files/${_Ccon}"
	"${_gentoo_uri}/net-misc/connman/files/${_Icon}")

pkgver() {
	date +%Y%m%d
}

_shebang='s|#!/sbin/runscript|#!/usr/bin/runscript|'
_runpath='s|/var/run|/run|g'
_binpath='s|/usr/sbin|/usr/bin|g'


package_cpupower-openrc() {
	true
	pkgdesc="OpenRC cpupower init script"
	depends=('openrc-base' 'cpupower')
	backup=('etc/conf.d/cpupower')
	install=cpupower.install

	install -Dm755 "${srcdir}/${_Ccpu}" "${pkgdir}/etc/conf.d/cpupower"
	install -Dm755 "${srcdir}/${_Icpu}" "${pkgdir}/etc/init.d/cpupower"

	sed -e "${_shebang}" -i "${pkgdir}/etc/init.d/cpupower"
}

package_connman-openrc() {
	true
	pkgdesc="OpenRC connman init script"
	depends=('openrc-base' 'connman')
	backup=('etc/conf.d/connman')
	install=connman.install

	install -Dm755 "${srcdir}/${_Ccon}" "${pkgdir}/etc/conf.d/connman"
	install -Dm755 "${srcdir}/${_Icon}" "${pkgdir}/etc/init.d/connman"

	sed -e "${_shebang}" -e "${_binpath}" -i "${pkgdir}/etc/init.d/connman"
}

package_cups-openrc() {
	true
	pkgdesc="OpenRC cups init script"
	depends=('cups' 'dbus-openrc')
	optdepends=('avahi-openrc')
	install=cups.install

	install -Dm755 "${srcdir}/${_Icups}" "${pkgdir}/etc/init.d/cupsd"

	local _p1='s|lp:lpadmin|daemon:sys|' _p2='s|@neededservices@|need dbus avahi-daemon|'
	sed -e "${_shebang}" -e "${_binpath}" -e "${_p1}" -e "${_p2}" -i "${pkgdir}/etc/init.d/cupsd"
}

package_fcron-openrc() {
	true
	pkgdesc="OpenRC fcron init script"
	depends=('openrc-base' 'fcron')
	groups=('openrc-misc')
	provides=('openrc-cron')
	conflicts=('cronie' 'cronie-openrc' 'openrc-arch-services-git'
		  'initscripts' 'systemd-sysvcompat' 'openrc' 'openrc-git')
	install=fcron.install

	install -Dm755 "${srcdir}/${_Ifrcon}" "${pkgdir}/etc/init.d/fcron"

	local _p1='s|/usr/libexec|/usr/bin|g'
	sed -e "${_shebang}" -e "${_runpath}" -e "${_p1}" -i "${pkgdir}/etc/init.d/fcron"
}

package_ntp-openrc() {
	true
	pkgdesc="OpenRC ntp init script"
	depends=('openrc-base' 'ntp')
	optdepends=('bind-openrc')
	provides=('openrc-timed')
	conflicts=('openntpd-openrc' 'openntpd' 'openrc-arch-services-git'
		  'initscripts' 'systemd-sysvcompat' 'openrc' 'openrc-git')
	backup=('etc/conf.d/ntpd' 'etc/conf.d/ntp-client' 'etc/init.d/sntp')
	install=ntp.install

	install -Dm755 "${srcdir}/${_Cntp1}" "${pkgdir}/etc/conf.d/ntpd"
	install -Dm755 "${srcdir}/${_Intp1}" "${pkgdir}/etc/init.d/ntpd"
	install -Dm755 "${srcdir}/${_Cntp2}" "${pkgdir}/etc/conf.d/ntp-client"
	install -Dm755 "${srcdir}/${_Intp2}" "${pkgdir}/etc/init.d/ntp-client"
	install -Dm755 "${srcdir}/${_Cntp3}" "${pkgdir}/etc/conf.d/sntp"
	install -Dm755 "${srcdir}/${_Intp3}" "${pkgdir}/etc/init.d/sntp"

	for f in ${pkgdir}/etc/init.d/*;do
	  sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i $f
	done
}

package_rsyslog-openrc() {
	true
	pkgdesc="OpenRC rsyslog init script"
	depends=('openrc-base' 'rsyslog')
	backup=('etc/conf.d/rsyslog')
	install=rsyslog.install

	install -Dm755 "${srcdir}/${_Crsysl}" "${pkgdir}/etc/conf.d/rsyslog"
	install -Dm755 "${srcdir}/${_Irsysl}" "${pkgdir}/etc/init.d/rsyslog"

	sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/rsyslog"
}

package_sane-openrc() {
	true
	pkgdesc="OpenRC sane init script"
	depends=('openrc-base' 'sane')
	backup=('etc/conf.d/saned')
	install=sane.install

	install -Dm755 "${srcdir}/${_Csane}" "${pkgdir}/etc/conf.d/saned"
	install -Dm755 "${srcdir}/${_Isane}" "${pkgdir}/etc/init.d/saned"

	sed -e "${_shebang}" -e "${_runpath}" -e "${_binpath}" -i ${pkgdir}/etc/init.d/saned
}

package_fuse-openrc(){
	true
	pkgdesc="OpenRC fuse init script"
	depends=('openrc-base' 'fuse')
	install=fuse.install

	install -Dm755 "${srcdir}/${_Ifuse}" "${pkgdir}/etc/init.d/fuse"
	sed -e "${_shebang}" -i "${pkgdir}/etc/init.d/fuse"
}

package_metalog-openrc() {
	true
	pkgdesc="OpenRC metalog init script"
	depends=('openrc-base' 'metalog')
	backup=('etc/conf.d/metalog')
	install=metalog.install

	install -Dm755 "${srcdir}/${_Cmeta}" "${pkgdir}/etc/conf.d/metalog"
	install -Dm755 "${srcdir}/${_Imeta}" "${pkgdir}/etc/init.d/metalog"

	sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/metalog"
}

package_syslog-ng-openrc() {
	true
	pkgdesc="OpenRC syslog-ng init script"
	depends=('openrc-base' 'syslog-ng')
	backup=('etc/conf.d/syslog-ng')
	install=syslog-ng.install

	install -Dm755 "${srcdir}/${_Csyslog}" "${pkgdir}/etc/conf.d/syslog-ng"
	install -Dm755 "${srcdir}/${_Isyslog}" "${pkgdir}/etc/init.d/syslog-ng"

	sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/syslog-ng"
}

package_lm_sensors-openrc() {
	true
	pkgdesc="OpenRC lm_sensors init script"
	depends=('openrc-base' 'lm_sensors')
	#backup=('etc/conf.d/sensord')
	install=lm_sensors.install

	#install -Dm755 "${srcdir}/${_Csens}" "${pkgdir}/etc/conf.d/sensord"
	install -Dm755 "${srcdir}/${_Isens1}" "${pkgdir}/etc/init.d/sensord"
	install -Dm755 "${srcdir}/${_Isens2}" "${pkgdir}/etc/init.d/fancontrol"
	install -Dm755 "${srcdir}/${_Isens3}" "${pkgdir}/etc/init.d/lm_sensors"

	for f in ${pkgdir}/etc/init.d/*;
	do
	  sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i $f
	done
}

package_lirc-utils-openrc() {
	true
	pkgdesc="OpenRC lirc-utils init script"
	depends=('openrc-base' 'lirc-utils')
	backup=('etc/conf.d/lircd' 'etc/conf.d/irexec')
	install=lirc-utils.install

	install -Dm755 "${srcdir}/${_Clirc1}" "${pkgdir}/etc/conf.d/lircd"
	install -Dm755 "${srcdir}/${_Ilirc1}" "${pkgdir}/etc/init.d/lircd"

	install -Dm755 "${srcdir}/${_Clirc2}" "${pkgdir}/etc/conf.d/irexec"
	install -Dm755 "${srcdir}/${_Ilirc2}" "${pkgdir}/etc/init.d/irexec"

	install -Dm755 "${srcdir}/${_Ilirc3}" "${pkgdir}/etc/init.d/lircmd"

	for f in ${pkgdir}/etc/init.d/*;do
	  sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i $f
	done
}

# Comment out if you build for your personal repo
# remove 'openrc-misc' from pkgname array
# Dummy package to make AUR display correct info
# If installed, it should make upgrade from AUR possible
package_openrc-misc() {
	true
	pkgdesc="OpenRC misc init scripts, AUR upgrade and info split-pkg helper"
	depends=('openrc-base')
	makedepends=('openrc-base')
# 	depends=('cpupower-openrc'
# 			'connman-openrc'
# 			'fcron-openrc'
# 			'fuse-openrc'
# 			'metalog-openrc'
# 			'rsyslog-openrc'
# 			'sane-openrc'
# 			'syslog-ng-openrc'
# 			'lirc-utils-openrc'
# 			'lm_sensors-openrc'
# 			'ntp-openrc'
# 			'cups-openrc')
	provides=('openrc-misc-aur-helper')
	conflicts=('openrc'
			'openrc-git'
			'openrc-arch-services-git'
			'initscripts'
			'systemd-sysvcompat'
			'openrc-misc-split')
	replaces=('openrc-misc-split')
}
md5sums=('247eca77354c12a8227c100d3f444591'
         '933278fd8285dd3e12bf1165fee3a32f'
         '69d6c61f1c17e60892172e0e33be81b5'
         '0f33688c4439b137144000bbb8879cd8'
         'feeefeea9feff271441e2fccd30ed54f'
         '5983726cfabf0830dffbbbf9a3abcddc'
         'ec30e8aa71d3b8fa92e0d6d1ca908797'
         '7110deeeef2e74a4308460838b95f24b'
         'a3fc96ff3b9e03214fd1dccc669793eb'
         '366a7f4be295424f3b1f51327b47d71e'
         '7de9952f9cc2d70f2cd5206b403d003a'
         '6abeb719007a883ff202cd75ffe922e8'
         'f8295e964d7c8dd487eca89ca31e611e'
         '9206366d0a0f086d344660837cfe0c44'
         '54581835f791fe37a1285926c6d21b12'
         'fc335236f7617b042066c6231d5c9b87'
         '487b13818444bb871a9f760846c8b814'
         'd4ec1854397c9292d682bec49e40fec6'
         '2edfb737e48514b930f38d8ac22fda69'
         '2c7e97203da2c39bc9fbfc2a4849cfd4'
         'a02414664cb5f8dfe57d114ab570533d'
         'e2bae793e36713f8ce99091e2eaee727'
         'c640b9e1261049f39f32c7bab5d27efe'
         '49a30ff9af7a2f0ca60fe724966ca9d4'
         '46175ddc1e530f088fbd3b510f40a987'
         '036370bb3d755ceaf00b943cf27d368e'
         '89602e0f40b84994f335703823aa43d9'
         'b96d0ab1d8c0463b621d984c801ff4bd'
         'c1513db2adf39eeb168874fa1938ce29')
