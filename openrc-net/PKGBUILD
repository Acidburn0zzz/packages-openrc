# Maintainer: udeved <udeved@openrc4arch.site40.net>

# file vars for easy update
_Cbind=named.confd-r6
_Ibind=named.init-r12
_Cbit=bitlbee.confd
_Ibit=bitlbee.initd
_Cblue=rfcomm-conf.d
_Iblue=(rfcomm-init.d bluetooth-init.d-r2)
_Ccon=connman.confd
_Icon=connman.initd2
_Icups=cupsd.init.d-r1
_Isasl=saslauthd2.rc7
_Cdhcp=(dhcpd.conf2 dhcrelay.conf dhcrelay6.conf)
_Idhcp=(dhcpd.init5 dhcrelay.init3)
_Idhcpcd=dhcpcd.initd
_Chost=hostapd-conf.d
_Ihost=hostapd-init.d
_Cip=(iptables-1.4.13.confd ip6tables-1.4.13.confd)
_Iip=iptables-1.4.13-r1.init
_Ikrb=(mit-krb5kadmind.initd-r1 mit-krb5kdc.initd-r1 mit-krb5kpropd.initd-r1)
_Clight=lighttpd.confd
_Ilight=lighttpd.initd
_Cnfs=nfs.confd
_Infs=(nfs.initd nfsmount.initd rpc.gssd.initd rpc.idmapd.initd rpc.pipefs.initd rpc.statd.initd rpc.svcgssd.initd)
_Cntp=(ntpd.confd ntp-client.confd sntp.confd)
_Intp=(ntpd.rc ntp-client.rc sntp.rc)
_Cldap=slapd-confd-2.4.28-r1
_Ildap=slapd-initd-2.4.28-r1
_Islp=slpd-init
_Cssh=sshd.confd
_Issh=sshd.rc6.4
_Ipolip=polipo.initd
_Ipostfix=postfix.rc6.2.7
_Ipriv=privoxy.initd
_Cquota=quota.confd
_Iquota=(quota.rc7 rpc.rquotad.initd)
_Crpc=rpcbind.confd
_Irpc=rpcbind.initd
_Crsync=rsyncd.conf.d
_Irsync=rsyncd.init.d-r1
_Csmb=samba4.confd
_Ismb=samba4.initd-r1
_Csquid=squid.confd-r1
_Isquid=squid.initd-r3
_Ctrans=transmission-daemon.confd.4
_Itrans=transmission-daemon.initd.9
_Cufw=ufw.confd
_Iufw=ufw-2.initd
_Ivsftp=vsftpd.init
_Svsftp=vsftpd-checkconfig.sh
_Iwicd=wicd-init.d
_Cwpa=wpa_supplicant-conf.d
_Iwpa=wpa_supplicant-init.d
_Swpa=wpa_cli.sh
_Cxinet=xinetd.confd
_Ixinet=xinetd.rc6
_Cypbind=ypbind.confd-r1
_Iypbind=ypbind.initd
_Cypserv=(ypserv.confd rpc.yppasswdd.confd rpc.ypxfrd.confd)
_Iypserv=(ypserv rpc.yppasswdd-r1 rpc.ypxfrd-2.23)
_Iautofs=autofs5.initd
_Cvpn=openvpn-2.1.conf
_Ivpn=openvpn-2.1.init

_apver=2.4.4
_aprel=20130802

_dev_uri="http://dev.gentoo.org/~kensington/dist/apache"
_gentoo_uri="http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86"

pkgbase=openrc-net-split
pkgname=openrc-net-split
true && pkgname=('autofs-openrc' 'apache-openrc' 'bind-openrc' 'bitlbee-openrc' 'bluez-openrc' 'connman-openrc' 'cups-openrc' 'cyrus-sasl-openrc' 'dhcp-openrc' 'dhcpcd-openrc' 'hostapd-openrc'
		'inetutils-openrc' 'iptables-openrc' 'krb5-openrc' 'lighttpd-openrc' 'nfs-utils-openrc' 'ntp-openrc' 'openldap-openrc' 'openslp-openrc' 'openssh-openrc' 'polipo-openrc' 'postfix-openrc'
		'privoxy-openrc' 'quota-tools-openrc' 'rpcbind-openrc' 'rsync-openrc' 'samba-openrc' 'squid-openrc' 'transmission-openrc' 'ufw-openrc' 'vsftpd-openrc' 'wicd-openrc' 'wpa_supplicant-openrc'
		'xinetd-openrc'	'ypbind-mt-openrc' 'ypserv-openrc' 'openvpn-openrc' 'openrc-net-split')
pkgver=20131102
pkgrel=1
pkgdesc="OpenRC init scripts"
arch=('any')
url="http://openrc4arch.site40.net"
license=('GPL2')
groups=('openrc' 'openrc-net')
makedepends=('autofs' 'apache' 'bind' 'bitlbee' 'bluez' 'connman' 'cups' 'cyrus-sasl' 'dbus-openrc' 'device-mapper-openrc' 'dhcp' 'dhcpcd' 'hostapd' 'inetutils' 'iptables' 'krb5' 'lighttpd' 'nfs-utils'
'ntp' 'openldap' 'openslp' 'openssh' 'polipo' 'postfix' 'privoxy' 'quota-tools' 'rpcbind' 'rsync' 'samba' 'squid' 'transmission-cli' 'ufw' 'vsftpd' 'wicd' 'wpa_supplicant' 'xinetd' 'ypbind-mt' 'ypserv' 'openvpn')
conflicts=('openrc-arch-services-git' 'initscripts' 'systemd-sysvcompat' 'openrc' 'openrc-git')
source=("${_dev_uri}/gentoo-apache-${_apver}-${_aprel}.tar.bz2"
	"${_gentoo_uri}/net-dns/bind/files/${_Cbind}"
	"${_gentoo_uri}/net-dns/bind/files/${_Ibind}"
	"${_gentoo_uri}/net-im/bitlbee/files/${_Cbit}"
	"${_gentoo_uri}/net-im/bitlbee/files/${_Ibit}"
	"${_gentoo_uri}/net-wireless/bluez/files/${_Cblue}"
	"${_gentoo_uri}/net-wireless/bluez/files/${_Iblue[0]}"
	"${_gentoo_uri}/net-wireless/bluez/files/${_Iblue[1]}"
	"${_gentoo_uri}/net-misc/connman/files/${_Ccon}"
	"${_gentoo_uri}/net-misc/connman/files/${_Icon}"
	"${_gentoo_uri}/net-print/cups/files/${_Icups}"
	"${_gentoo_uri}/dev-libs/cyrus-sasl/files/${_Isasl}"
	"${_gentoo_uri}/net-misc/dhcp/files/${_Cdhcp[0]}"
	"${_gentoo_uri}/net-misc/dhcp/files/${_Idhcp[0]}"
	"${_gentoo_uri}/net-misc/dhcp/files/${_Cdhcp[1]}"
	"${_gentoo_uri}/net-misc/dhcp/files/${_Cdhcp[2]}"
	"${_gentoo_uri}/net-misc/dhcp/files/${_Idhcp[1]}"
	"${_gentoo_uri}/net-misc/dhcpcd/files/${_Idhcpcd}"
	"${_gentoo_uri}/net-wireless/hostapd/files/${_Chost}"
	"${_gentoo_uri}/net-wireless/hostapd/files/${_Ihost}"
	'inetutils.confd'
	'inetutils.initd'
	"${_gentoo_uri}/net-firewall/iptables/files/${_Cip[0]}"
	"${_gentoo_uri}/net-firewall/iptables/files/${_Cip[1]}"
	"${_gentoo_uri}/net-firewall/iptables/files/${_Iip}"
	"${_gentoo_uri}/app-crypt/mit-krb5/files/${_Ikrb[0]}"
	"${_gentoo_uri}/app-crypt/mit-krb5/files/${_Ikrb[1]}"
	"${_gentoo_uri}/app-crypt/mit-krb5/files/${_Ikrb[2]}"
	"${_gentoo_uri}/www-servers/lighttpd/files/${_Clight}"
	"${_gentoo_uri}/www-servers/lighttpd/files/${_Ilight}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Cnfs}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs[0]}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs[1]}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs[2]}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs[3]}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs[4]}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs[5]}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs[6]}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Cntp[0]}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Intp[0]}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Cntp[1]}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Intp[1]}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Cntp[2]}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Intp[2]}"
	"${_gentoo_uri}/net-nds/openldap/files/${_Cldap}"
	"${_gentoo_uri}/net-nds/openldap/files/${_Ildap}"
	"${_gentoo_uri}/net-libs/openslp/files/${_Islp}"
	"${_gentoo_uri}/net-misc/openssh/files/${_Cssh}"
	"${_gentoo_uri}/net-misc/openssh/files/${_Issh}"
	"${_gentoo_uri}/net-proxy/polipo/files/${_Ipolip}"
	"${_gentoo_uri}/mail-mta/postfix/files/${_Ipostfix}"
	"${_gentoo_uri}/net-proxy/privoxy/files/${_Ipriv}"
	"${_gentoo_uri}/sys-fs/quota/files/${_Cquota}"
	"${_gentoo_uri}/sys-fs/quota/files/${_Iquota[0]}"
	"${_gentoo_uri}/sys-fs/quota/files/${_Iquota[1]}"
	"${_gentoo_uri}/net-nds/rpcbind/files/${_Crpc}"
	"${_gentoo_uri}/net-nds/rpcbind/files/${_Irpc}"
	"${_gentoo_uri}/net-misc/rsync/files/${_Crsync}"
	"${_gentoo_uri}/net-misc/rsync/files/${_Irsync}"
	"${_gentoo_uri}/net-fs/samba/files/4.1/${_Csmb}"
	"${_gentoo_uri}/net-fs/samba/files/4.1/${_Ismb}"
	"${_gentoo_uri}/net-proxy/squid/files/${_Csquid}"
	"${_gentoo_uri}/net-proxy/squid/files/${_Isquid}"
	"${_gentoo_uri}/net-p2p/transmission/files/${_Ctrans}"
	"${_gentoo_uri}/net-p2p/transmission/files/${_Itrans}"
	"${_gentoo_uri}/net-firewall/ufw/files/${_Cufw}"
	"${_gentoo_uri}/net-firewall/ufw/files/${_Iufw}"
	"${_gentoo_uri}/net-ftp/vsftpd/files/${_Ivsftp}"
	"${_gentoo_uri}/net-ftp/vsftpd/files/${_Svsftp}"
	"${_gentoo_uri}/net-misc/wicd/files/${_Iwicd}"
	"${_gentoo_uri}/net-wireless/wpa_supplicant/files/${_Cwpa}"
	"${_gentoo_uri}/net-wireless/wpa_supplicant/files/${_Iwpa}"
	"${_gentoo_uri}/net-wireless/wpa_supplicant/files/${_Swpa}"
	"${_gentoo_uri}/sys-apps/xinetd/files/${_Cxinet}"
	"${_gentoo_uri}/sys-apps/xinetd/files/${_Ixinet}"
	"${_gentoo_uri}/net-nds/ypbind/files/${_Cypbind}"
	"${_gentoo_uri}/net-nds/ypbind/files/${_Iypbind}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Cypserv[0]}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Iypserv[0]}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Cypserv[1]}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Iypserv[1]}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Cypserv[2]}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Iypserv[2]}"
	"${_gentoo_uri}/net-fs/autofs/files/${_Iautofs}"
	"${_gentoo_uri}/net-misc/openvpn/files/${_Cvpn}"
	"${_gentoo_uri}/net-misc/openvpn/files/${_Ivpn}")


# pkgver() {
#   date +%Y%m%d
# }

_shebang='s|#!/sbin/runscript|#!/usr/bin/runscript|'
_runpath='s|/var/run|/run|g'
_binpath=('s|/usr/sbin|/usr/bin|g' 's|/sbin|/usr/bin|g')

package_apache-openrc() {
	true
	pkgdesc="OpenRC apache init script"
	depends=('openrc-base' 'apache')
	backup=('etc/conf.d/httpd')
	install=apache.install

	install -Dm755 "${srcdir}/gentoo-apache-${_apver}/init/apache2.confd" "${pkgdir}/etc/conf.d/httpd"
	install -Dm755 "${srcdir}/gentoo-apache-${_apver}/init/apache2.initd" "${pkgdir}/etc/init.d/httpd"

	local _p1='s|apache2|httpd|g' _p2='s|/etc/httpd/httpd.conf|/etc/httpd/conf/httpd.conf|g'
	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_p1}" -e "${_p2}" -i "${pkgdir}/etc/init.d/httpd"
}

package_bind-openrc() {
	true
	pkgdesc="OpenRC bind init script"
	depends=('openrc-base' 'bind')
	backup=('etc/conf.d/named')
	install=bind.install

	install -Dm755 "${srcdir}/${_Cbind}" "${pkgdir}/etc/conf.d/named"
	install -Dm755 "${srcdir}/${_Ibind}" "${pkgdir}/etc/init.d/named"

	local _p1='s|/etc/bind/named.conf|/etc/named.conf|g'
	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -i "${pkgdir}/etc/init.d/named"
}

package_bitlbee-openrc() {
	true
	pkgdesc="OpenRC bitlbee init script"
	depends=('openrc-base' 'bitlbee')
	backup=('etc/conf.d/bitlbee')
	install=bitlbee.install

	install -Dm755 "${srcdir}/${_Cbit}" "${pkgdir}/etc/conf.d/bitlbee"
	install -Dm755 "${srcdir}/${_Ibit}" "${pkgdir}/etc/init.d/bitlbee"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/bitlbee"
}

package_bluez-openrc() {
	true
	pkgdesc="OpenRC bluez init script"
	depends=('bluez' 'dbus-openrc')
	backup=('etc/conf.d/rfcomm')
	install=bluez.install

	install -Dm755 "${srcdir}/${_Cblue}" "${pkgdir}/etc/conf.d/rfcomm"
	install -Dm755 "${srcdir}/${_Iblue[0]}" "${pkgdir}/etc/init.d/rfcomm"
	install -Dm755 "${srcdir}/${_Iblue[1]}" "${pkgdir}/etc/init.d/bluetooth"

	for f in ${pkgdir}/etc/init.d/*;do
	  sed -e "${_shebang}" -e "${_binpath[0]}" -i $f
	done
}

package_connman-openrc() {
	true
	pkgdesc="OpenRC connman init script"
	depends=('openrc-base' 'connman')
	backup=('etc/conf.d/connman')
	install=connman.install

	install -Dm755 "${srcdir}/${_Ccon}" "${pkgdir}/etc/conf.d/connman"
	install -Dm755 "${srcdir}/${_Icon}" "${pkgdir}/etc/init.d/connman"

	sed -e "${_shebang}" -e "${_binpath[0]}" -i "${pkgdir}/etc/init.d/connman"
}

package_cups-openrc() {
	true
	pkgdesc="OpenRC cups init script"
	depends=('cups' 'dbus-openrc')
	optdepends=('avahi-openrc')
	install=cups.install

	install -Dm755 "${srcdir}/${_Icups}" "${pkgdir}/etc/init.d/cupsd"

	local _p1='s|lp:lpadmin|daemon:sys|' _p2='s|@neededservices@|need dbus avahi-daemon|'
	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_p1}" -e "${_p2}" -i "${pkgdir}/etc/init.d/cupsd"
}

package_cyrus-sasl-openrc() {
	true
	pkgdesc="OpenRC cyrus-sasl init script"
	depends=('openrc-base' 'cyrus-sasl')
	install=cyrus-sasl.install

	install -Dm755 "${srcdir}/${_Isasl}" "${pkgdir}/etc/init.d/saslauthd"

	sed -e "${_shebang}" -e "${_binpath[0]}" -i "${pkgdir}/etc/init.d/saslauthd"
}

package_dhcp-openrc() {
	true
	pkgdesc="OpenRC dhcp init script"
	depends=('openrc-base' 'dhcp')
	optdepends=('openldap-openrc' 'bind-openrc')
	backup=('etc/conf.d/dhcpd' 'etc/conf.d/dhcrelay' 'etc/conf.d/dhcrelay6')
	install=dhcp.install

	install -Dm755 "${srcdir}/${_Cdhcp[0]}" "${pkgdir}/etc/conf.d/dhcpd"
	install -Dm755 "${srcdir}/${_Idhcp[0]}" "${pkgdir}/etc/init.d/dhcpd"
	install -Dm755 "${srcdir}/${_Cdhcp[1]}" "${pkgdir}/etc/conf.d/dhcrelay"
	install -Dm755 "${srcdir}/${_Idhcp[1]}" "${pkgdir}/etc/init.d/dhcrelay"
	install -Dm755 "${srcdir}/${_Cdhcp[2]}" "${pkgdir}/etc/conf.d/dhcrelay6"
	install -Dm755 "${srcdir}/${_Idhcp[1]}" "${pkgdir}/etc/init.d/dhcrelay6"

	local _p1='s|#@slapd@|ldap slapd|'
	for f in ${pkgdir}/etc/init.d/*;do
	  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}"  -e "${_p1}" -i $f
	done
}

package_dhcpcd-openrc() {
	true
	pkgdesc="OpenRC dhcpcd init script"
	depends=('openrc-base' 'dhcpcd')
	install=dhcpcd.install

	install -Dm755 "${srcdir}/${_Idhcpcd}" "${pkgdir}/etc/init.d/dhcpcd"

	sed -e "${_shebang}" -e "${_binpath[1]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/dhcpcd"
}

package_hostapd-openrc() {
	true
	pkgdesc="OpenRC hostapd init script"
	depends=('openrc-base' 'hostapd')
	backup=('etc/conf.d/hostapd')
	install=hostapd.install

	install -Dm755 "${srcdir}/${_Chost}" "${pkgdir}/etc/conf.d/hostapd"
	install -Dm755 "${srcdir}/${_Ihost}" "${pkgdir}/etc/init.d/hostapd"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/hostapd"
}

package_inetutils-openrc() {
	true
	pkgdesc="OpenRC ftpd init script"
	depends=('openrc-base' 'inetutils')
	backup=('etc/conf.d/ftpd')
	install=inetutils.install

	install -Dm755 "${srcdir}/inetutils.confd" "${pkgdir}/etc/conf.d/ftpd"
	install -Dm755 "${srcdir}/inetutils.initd" "${pkgdir}/etc/init.d/ftpd"
}

package_iptables-openrc() {
	true
	pkgdesc="OpenRC iptables init script"
	depends=('openrc-base' 'iptables')
	backup=('etc/conf.d/iptables' 'etc/conf.d/ip6tables')
	install=iptables.install

	install -Dm755 "${srcdir}/${_Cip[0]}" "${pkgdir}/etc/conf.d/iptables"
	install -Dm755 "${srcdir}/${_Iip}" "${pkgdir}/etc/init.d/iptables"
	install -Dm755 "${srcdir}/${_Cip[1]}" "${pkgdir}/etc/conf.d/ip6tables"
	install -Dm755 "${srcdir}/${_Iip}" "${pkgdir}/etc/init.d/ip6tables"

	for f in ${pkgdir}/etc/init.d/*;do
	  sed -e "${_shebang}" -e "${_binpath[1]}" -e "${_runpath}" -i $f
	done
}

package_krb5-openrc() {
	true
	pkgdesc="OpenRC krb5 init script"
	depends=('openrc-base' 'krb5')
	install=krb5.install

	install -Dm755 "${srcdir}/${_Ikrb[0]}" "${pkgdir}/etc/init.d/krb5kadmind"
	install -Dm755 "${srcdir}/${_Ikrb[1]}" "${pkgdir}/etc/init.d/krb5kdc"
	install -Dm755 "${srcdir}/${_Ikrb[2]}" "${pkgdir}/etc/init.d/krb5kpropd"

	local _p1='s|mit-krb5kdc|krb5kdc|g' _p2='s|mit-krb5kadmind|krb5kadmind|g'
	for f in ${pkgdir}/etc/init.d/*;do
	  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -e "${_p2}" -i $f
	done
}

package_lighttpd-openrc() {
	true
	pkgdesc="OpenRC lighttpd init script"
	depends=('openrc-base' 'lighttpd')
	backup=('etc/conf.d/lighttpd')
	install=lighttpd.install

	install -Dm755 "${srcdir}/${_Clight}" "${pkgdir}/etc/conf.d/lighttpd"
	install -Dm755 "${srcdir}/${_Ilight}" "${pkgdir}/etc/init.d/lighttpd"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/lighttpd"
}

package_rpcbind-openrc() {
	true
	pkgdesc="OpenRC rpcbind init script"
	depends=('openrc-base' 'rpcbind')
	backup=('etc/conf.d/rpcbind')
	install=rpcbind.install

	install -Dm755 "${srcdir}/${_Crpc}" "${pkgdir}/etc/conf.d/rpcbind"
	install -Dm755 "${srcdir}/${_Irpc}" "${pkgdir}/etc/init.d/rpcbind"

	sed -e "${_shebang}" -e "${_binpath[1]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/rpcbind"
}

package_nfs-utils-openrc() {
	true
	pkgdesc="OpenRC nfs-utils init script"
	depends=('nfs-utils' 'rpcbind-openrc' 'device-mapper-openrc')
	optdepends=('ypbind-openrc' 'quota-tools-openrc' 'bind-openrc')
	backup=('etc/conf.d/nfs-rc')
	install=nfs-utils.install

	install -Dm755 "${srcdir}/${_Cnfs}" "${pkgdir}/etc/conf.d/nfs-rc"
	install -Dm755 "${srcdir}/${_Infs[0]}" "${pkgdir}/etc/init.d/nfs-rc"
	install -Dm755 "${srcdir}/${_Infs[1]}" "${pkgdir}/etc/init.d/nfsmount"
	install -Dm755 "${srcdir}/${_Infs[2]}" "${pkgdir}/etc/init.d/rpc.gssd"
	install -Dm755 "${srcdir}/${_Infs[3]}" "${pkgdir}/etc/init.d/rpc.idmapd"
	install -Dm755 "${srcdir}/${_Infs[4]}" "${pkgdir}/etc/init.d/rpc.pipefs"
	install -Dm755 "${srcdir}/${_Infs[5]}" "${pkgdir}/etc/init.d/rpc.statd"
	install -Dm755 "${srcdir}/${_Infs[6]}" "${pkgdir}/etc/init.d/rpc.svcgssd"

	local _p1='s|/etc/conf.d/nfs|/etc/conf.d/nfs-rc|g'

	for f in ${pkgdir}/etc/init.d/*;do
	  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}"  -e "${_p1}" -i $f
	done
}

package_ntp-openrc() {
	true
	pkgdesc="OpenRC ntp init script"
	depends=('openrc-base' 'ntp')
	optdepends=('bind-openrc')
	provides=('openrc-timed')
	conflicts=('openntpd-openrc' 'openntpd' 'openrc-arch-services-git'
		  'initscripts' 'systemd-sysvcompat' 'openrc' 'openrc-git')
	backup=('etc/conf.d/ntpd' 'etc/conf.d/ntp-client' 'etc/init.d/sntp')
	install=ntp.install

	install -Dm755 "${srcdir}/${_Cntp[0]}" "${pkgdir}/etc/conf.d/ntpd"
	install -Dm755 "${srcdir}/${_Intp[0]}" "${pkgdir}/etc/init.d/ntpd"
	install -Dm755 "${srcdir}/${_Cntp[1]}" "${pkgdir}/etc/conf.d/ntp-client"
	install -Dm755 "${srcdir}/${_Intp[1]}" "${pkgdir}/etc/init.d/ntp-client"
	install -Dm755 "${srcdir}/${_Cntp[2]}" "${pkgdir}/etc/conf.d/sntp"
	install -Dm755 "${srcdir}/${_Intp[2]}" "${pkgdir}/etc/init.d/sntp"

	for f in ${pkgdir}/etc/init.d/*;do
	  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i $f
	done
}

package_openldap-openrc() {
	true
	pkgdesc="OpenRC openldap init script"
	depends=('openrc-base' 'openldap')
	backup=('etc/conf.d/slapd')
	install=openldap.install

	install -Dm755 "${srcdir}/${_Cldap}" "${pkgdir}/etc/conf.d/slapd"
	install -Dm755 "${srcdir}/${_Ildap}" "${pkgdir}/etc/init.d/slapd"

	local _p1='s|/usr/lib/openldap/slapd|/usr/lib/slapd|g'
	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -i "${pkgdir}/etc/init.d/slapd"
}

package_openslp-openrc() {
	true
	pkgdesc="OpenRC openslp init script"
	depends=('openrc-base' 'openslp')
	install=openslp.install

	install -Dm755 "${srcdir}/${_Islp}" "${pkgdir}/etc/init.d/slpd"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/slpd"
}

package_openssh-openrc() {
	true
	pkgdesc="OpenRC openssh init script"
	depends=('openrc-base' 'openssh')
	optdepends=('bind-openrc')
	backup=('etc/conf.d/sshd')
	install=openssh.install

	install -Dm755 "${srcdir}/${_Cssh}" "${pkgdir}/etc/conf.d/sshd"
	install -Dm755 "${srcdir}/${_Issh}" "${pkgdir}/etc/init.d/sshd"

	sed -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/conf.d/sshd"
	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/sshd"
}

package_polipo-openrc() {
	true
	pkgdesc="OpenRC polipo init script"
	depends=('openrc-base' 'polipo')
	install=polipo.install

	install -Dm755 "${srcdir}/${_Ipolip}" "${pkgdir}/etc/init.d/polipo"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/polipo"
}

package_postfix-openrc() {
	true
	pkgdesc="OpenRC postfix init script"
	depends=('openrc-base' 'postfix')
	optdepends=('bind-openrc' 'ypbind-openrc' 'cyrus-sasl-openrc')
	install=postfix.install

	install -Dm755 "${srcdir}/${_Ipostfix}" "${pkgdir}/etc/init.d/postfix"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/postfix"
}

package_privoxy-openrc() {
	true
	pkgdesc="OpenRC privoxy init script"
	depends=('openrc-base' 'privoxy')
	install=privoxy.install

	install -Dm755 "${srcdir}/${_Ipriv}" "${pkgdir}/etc/init.d/privoxy"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/privoxy"
}

package_quota-tools-openrc() {
	true
	pkgdesc="OpenRC quota-tools init script"
	depends=('quota-tools' 'rpcbind-openrc')
	optdepends=('ypbind-openrc')
	backup=('etc/conf.d/quota')
	install=quota-tools.install

	install -Dm755 "${srcdir}/${_Cquota}" "${pkgdir}/etc/conf.d/quota"
	install -Dm755 "${srcdir}/${_Iquota[0]}" "${pkgdir}/etc/init.d/quota"
	install -Dm755 "${srcdir}/${_Iquota[1]}" "${pkgdir}/etc/init.d/rpc.rquotad"


	for f in ${pkgdir}/etc/init.d/*;do
	  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i $f
	done

	local _p1='s|/etc/conf.d/nfs|/etc/conf.d/nfs-rc|g'
	sed -e "${_p1}" -i "${pkgdir}/etc/init.d/rpc.rquotad"
}

package_rsync-openrc() {
	true
	pkgdesc="OpenRC rsync init script"
	depends=('openrc-base' 'rsync')
	backup=('etc/conf.d/rsyncd')
	install=rsync.install

	install -Dm755 "${srcdir}/${_Crsync}" "${pkgdir}/etc/conf.d/rsyncd"
	install -Dm755 "${srcdir}/${_Irsync}" "${pkgdir}/etc/init.d/rsyncd"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/rsyncd"
}

package_samba-openrc() {
	true
	pkgdesc="OpenRC samba init script"
	depends=('openrc-base' 'samba')
	backup=('etc/conf.d/samba-rc')
	install=samba.install

	install -Dm755 "${srcdir}/${_Csmb}" "${pkgdir}/etc/conf.d/samba-rc"
	install -Dm755 "${srcdir}/${_Ismb}" "${pkgdir}/etc/init.d/samba-rc"

	local _p1='s|SVCNAME##samba|SVCNAME##samba-rc|g' _p2='s|"samba"|"samba-rc"|g'
	sed -e "${_binpath[0]}" -i "${pkgdir}/etc/conf.d/samba-rc"
	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -e "${_p2}" -i "${pkgdir}/etc/init.d/samba-rc"
}

package_squid-openrc() {
	true
	pkgdesc="OpenRC squid init script"
	depends=('openrc-base' 'squid')
	optdepends=('bind-openrc')
	backup=('etc/conf.d/squid')
	install=squid.install

	install -Dm755 "${srcdir}/${_Csquid}" "${pkgdir}/etc/conf.d/squid"
	install -Dm755 "${srcdir}/${_Isquid}" "${pkgdir}/etc/init.d/squid"

	local _p1='s|chown squid|chown proxy|g'
	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -i "${pkgdir}/etc/init.d/squid"
}

package_transmission-openrc() {
	true
	pkgdesc="OpenRC transmission init script"
	depends=('openrc-base' 'transmission-cli')
	backup=('etc/conf.d/transmission-daemon')
	install=transmission.install

	install -Dm755 "${srcdir}/${_Ctrans}" "${pkgdir}/etc/conf.d/transmission-daemon"
	install -Dm755 "${srcdir}/${_Itrans}" "${pkgdir}/etc/init.d/transmission-daemon"

	sed -e "${_shebang}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/transmission-daemon"
}

package_ufw-openrc() {
	true
	pkgdesc="OpenRC ufw init script"
	depends=('openrc-base' 'ufw')
	backup=('etc/conf.d/ufw')
	install=ufw.install

	install -Dm755 "${srcdir}/${_Cufw}" "${pkgdir}/etc/conf.d/ufw"
	install -Dm755 "${srcdir}/${_Iufw}" "${pkgdir}/etc/init.d/ufw"

	local _p1='s|/usr/share/ufw/ufw-init-functions|/usr/lib/ufw/ufw-init-functions|g'
	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -i "${pkgdir}/etc/init.d/ufw"
}

package_vsftpd-openrc() {
	true
	pkgdesc="OpenRC vsftpd init script"
	depends=('openrc-base' 'vsftpd')
	optdepends=('bind-openrc')
	install=vsftpd.install

	install -Dm755 "${srcdir}/${_Ivsftp}" "${pkgdir}/etc/init.d/vsftpd"
	install -Dm755 "${srcdir}/${_Svsftp}" "${pkgdir}/usr/lib/vsftpd-checkconfig.sh"

	local _p1='s|/usr/libexec/|/usr/lib/|g' _p2='s|/etc/vsftpd/|/etc/|g'
	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -e "${_p2}" -i "${pkgdir}/etc/init.d/vsftpd"
	sed -e "${_p2}" -i "${pkgdir}/usr/lib/vsftpd-checkconfig.sh"
}

package_wpa_supplicant-openrc() {
	true
	pkgdesc="OpenRC wpa_supplicant init script"
	depends=('openrc-base' 'wpa_supplicant')
	backup=('etc/conf.d/wpa_supplicant')
	install=wpa_supplicant.install

	install -Dm755 "${srcdir}/${_Cwpa}" "${pkgdir}/etc/conf.d/wpa_supplicant"
	install -Dm755 "${srcdir}/${_Iwpa}" "${pkgdir}/etc/init.d/wpa_supplicant"
	install -Dm755 "${srcdir}/${_Swpa}" "${pkgdir}/etc/wpa_supplicant/wpa_cli.sh"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/wpa_supplicant"
	sed -e 's|gentoo-release|arch-release|' -i "${pkgdir}/etc/wpa_supplicant/wpa_cli.sh"
}

package_wicd-openrc() {
	true
	pkgdesc="OpenRC wicd init script"
	depends=('openrc-base' 'wicd')
	install=wicd.install

	install -Dm755 "${srcdir}/${_Iwicd}" "${pkgdir}/etc/init.d/wicd"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/wicd"
}

package_xinetd-openrc() {
	true
	pkgdesc="OpenRC xinetd init script"
	depends=('openrc-base' 'xinetd')
	backup=('etc/conf.d/xinetd')
	install=xinetd.install

	install -Dm755 "${srcdir}/${_Cxinet}" "${pkgdir}/etc/conf.d/xinetd"
	install -Dm755 "${srcdir}/${_Ixinet}" "${pkgdir}/etc/init.d/xinetd"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/xinetd"
}

package_ypbind-mt-openrc() {
	true
	pkgdesc="OpenRC ypbind-mt init script"
	depends=('ypbind-mt' 'rpcbind-openrc')
	optdepends=('ypserv-openrc')
	backup=('etc/conf.d/ypbind')
	install=ypbind-mt.install

	install -Dm755 "${srcdir}/${_Cypbind}" "${pkgdir}/etc/conf.d/ypbind"
	install -Dm755 "${srcdir}/${_Iypbind}" "${pkgdir}/etc/init.d/ypbind"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/ypbind"
}

package_ypserv-openrc() {
	true
	pkgdesc="OpenRC ypserv init script"
	depends=('openrc-base' 'ypserv')
	backup=('etc/conf.d/rpc.yppasswdd' 'etc/conf.d/rpc.ypxfrd' 'etc/conf.d/ypserv')
	install=ypserv.install

	install -Dm755 "${srcdir}/${_Cypserv[0]}" "${pkgdir}/etc/init.d/ypserv"
	install -Dm755 "${srcdir}/${_Iypserv[0]}" "${pkgdir}/etc/conf.d/ypserv"
	install -Dm755 "${srcdir}/${_Cypserv[1]}" "${pkgdir}/etc/conf.d/rpc.yppasswdd"
	install -Dm755 "${srcdir}/${_Iypserv[1]}" "${pkgdir}/etc/init.d/rpc.yppasswdd"
	install -Dm755 "${srcdir}/${_Cypserv[2]}" "${pkgdir}/etc/conf.d/rpc.ypxfrd"
	install -Dm755 "${srcdir}/${_Iypserv[2]}" "${pkgdir}/etc/init.d/rpc.ypxfrd"

	for f in ${pkgdir}/etc/init.d/*;do
	  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i $f
	done
}

package_autofs-openrc() {
	true
	pkgdesc="OpenRC autofs init script"
	depends=('openrc-base' 'autofs')
	install=autofs.install

	install -Dm755 "${srcdir}/${_Iautofs}" "${pkgdir}/etc/init.d/autofs"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/autofs"
}

package_openvpn-openrc() {
	true
	pkgdesc="OpenRC openvpn init script"
	depends=('openrc-base' 'openvpn')
	backup=('etc/conf.d/openvpn')
	install=openvpn.install

	install -Dm755 "${srcdir}/${_Cvpn}" "${pkgdir}/etc/conf.d/openvpn"
	install -Dm755 "${srcdir}/${_Ivpn}" "${pkgdir}/etc/init.d/openvpn"

	sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/openvpn"
}

# Comment out if you build for your personal repo
# remove 'openrc-net-split' from pkgname array
# Dummy package to make AUR display correct info
# If installed, it should make upgrade from AUR possible
package_openrc-net-split() {
	true
	pkgdesc="OpenRC net init scripts, AUR upgrade and info split-pkg helper"
	depends=('openrc-base')
	provides=("openrc-net-split-helper=${pkgver}")
}
