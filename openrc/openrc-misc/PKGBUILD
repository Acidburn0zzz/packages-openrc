# Maintainer: artoo <flower_of_life@gmx.net>

# file vars for easy update
_Ifrcon=fcron.init.3
_Crsysl=rsyslog.confd-r1
_Irsysl=rsyslog.initd-r1
_Csane=saned.confd
_Isane=saned.initd
_Ifuse=fuse.init
_Cmeta=metalog.confd
_Imeta=metalog.initd
_Csyslog=syslog-ng.confd
_Isyslog=syslog-ng.rc6
_Clirc1=lircd.conf.4
_Clirc2=irexec-confd
_Ilirc1=lircd-0.8.6-r2
_Ilirc2=irexec-initd-0.8.6-r2
_Ilirc3=lircmd
#_Csens=sensord-conf.d
_Isens1=sensord-4-init.d
_Isens2=fancontrol-init.d-2
_Isens3=lm_sensors-3-init.d
_Ccpu=conf.d-r2
_Icpu=init.d-r4
_Cntp1=ntpd.confd
_Cntp2=ntp-client.confd
_Cntp3=sntp.confd
_Intp1=ntpd.rc
_Intp2=ntp-client.rc
_Intp3=sntp.rc
_Icups=cupsd.init.d-r1
_Ccon=connman.confd
_Icon=connman.initd2
_Chaveg=haveged-conf.d
_Ihaveg=haveged-init.d.3
_Csalt_mtr=master-confd-1
_Isalt_mtr=master-initd-3
_Csalt_min=minion-confd-1
_Isalt_min=minion-initd-3
_Csalt_sync=syndic-confd-1
_Isalt_sync=syndic-initd-3
_Impd=mpd2.init

_gentoo_uri="http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86"

pkgbase=openrc-misc
pkgname=('cpupower-openrc'
	'connman-openrc'
	'fcron-openrc'
	'fuse-openrc'
	'metalog-openrc'
	'rsyslog-openrc'
	'sane-openrc'
	'syslog-ng-openrc'
	'lirc-utils-openrc'
	'lm_sensors-openrc'
	'ntp-openrc'
	'cups-openrc'
	'haveged-openrc'
	'salt-openrc'
	'mpd-openrc')
pkgver=20140612
pkgrel=1
pkgdesc="OpenRC init scripts"
arch=('any')
url="https://github.com/udeved/pkgbuilds"
license=('GPL2')
groups=('openrc' 'openrc-misc')
conflicts=('openrc'
	'openrc-git'
	'openrc-arch-services-git'
	'initscripts'
	'systemd-sysvcompat')
source=("${_gentoo_uri}/sys-process/fcron/files/${_Ifrcon}"
	"${_gentoo_uri}/app-admin/rsyslog/files/7-stable/${_Crsysl}"
	"${_gentoo_uri}/app-admin/rsyslog/files/7-stable/${_Irsysl}"
	"${_gentoo_uri}/media-gfx/sane-backends/files/${_Csane}"
	"${_gentoo_uri}/media-gfx/sane-backends/files/${_Isane}"
	"${_gentoo_uri}/sys-fs/fuse/files/${_Ifuse}"
	"${_gentoo_uri}/app-admin/metalog/files/${_Cmeta}"
	"${_gentoo_uri}/app-admin/metalog/files/${_Imeta}"
	"${_gentoo_uri}/app-admin/syslog-ng/files/3.5/${_Csyslog}"
	"${_gentoo_uri}/app-admin/syslog-ng/files/3.5/${_Isyslog}"
	"${_gentoo_uri}/app-misc/lirc/files/${_Clirc1}"
	"${_gentoo_uri}/app-misc/lirc/files/${_Clirc2}"
	"${_gentoo_uri}/app-misc/lirc/files/${_Ilirc1}"
	"${_gentoo_uri}/app-misc/lirc/files/${_Ilirc2}"
	"${_gentoo_uri}/app-misc/lirc/files/${_Ilirc3}"
	"${_gentoo_uri}/sys-power/cpupower/files/${_Ccpu}"
	"${_gentoo_uri}/sys-power/cpupower/files/${_Icpu}"
	#"${_gentoo_uri}/sys-apps/lm_sensors/files/${_Csens}"
	"${_gentoo_uri}/sys-apps/lm_sensors/files/${_Isens1}"
	"${_gentoo_uri}/sys-apps/lm_sensors/files/${_Isens2}"
	"${_gentoo_uri}/sys-apps/lm_sensors/files/${_Isens3}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Cntp1}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Cntp2}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Cntp3}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Intp1}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Intp2}"
	"${_gentoo_uri}/net-misc/ntp/files/${_Intp3}"
	"${_gentoo_uri}/net-print/cups/files/${_Icups}"
	"${_gentoo_uri}/net-misc/connman/files/${_Ccon}"
	"${_gentoo_uri}/net-misc/connman/files/${_Icon}"
	"${_gentoo_uri}/sys-apps/haveged/files/${_Chaveg}"
	"${_gentoo_uri}/sys-apps/haveged/files/${_Ihaveg}"
	"${_gentoo_uri}/app-admin/salt/files/${_Csalt_mtr}"
	"${_gentoo_uri}/app-admin/salt/files/${_Isalt_mtr}"
	"${_gentoo_uri}/app-admin/salt/files/${_Csalt_min}"
	"${_gentoo_uri}/app-admin/salt/files/${_Isalt_min}"
	"${_gentoo_uri}/app-admin/salt/files/${_Csalt_sync}"
	"${_gentoo_uri}/app-admin/salt/files/${_Isalt_sync}"
	"${_gentoo_uri}/media-sound/mpd/files/${_Impd}")

pkgver() {
  date +%Y%m%d
}

_shebang='s|#!/sbin/runscript|#!/usr/bin/runscript|'
_runpath='s|/var/run|/run|g'
_binpath='s|/usr/sbin|/usr/bin|g'


package_cpupower-openrc() {
  pkgdesc="OpenRC cpupower init script"
  depends=('openrc-core' 'cpupower')
  backup=('etc/conf.d/cpupower')
  install=cpupower.install

  install -Dm755 "${srcdir}/${_Ccpu}" "${pkgdir}/etc/conf.d/cpupower"
  install -Dm755 "${srcdir}/${_Icpu}" "${pkgdir}/etc/init.d/cpupower"

  sed -e "${_shebang}" -i "${pkgdir}/etc/init.d/cpupower"
}

package_connman-openrc() {
  pkgdesc="OpenRC connman init script"
  depends=('openrc-core' 'connman')
  backup=('etc/conf.d/connman')
  install=connman.install

  install -Dm755 "${srcdir}/${_Ccon}" "${pkgdir}/etc/conf.d/connman"
  install -Dm755 "${srcdir}/${_Icon}" "${pkgdir}/etc/init.d/connman"

  sed -e "${_shebang}" -e "${_binpath}" -i "${pkgdir}/etc/init.d/connman"
}

package_cups-openrc() {
  pkgdesc="OpenRC cups init script"
  depends=('cups' 'dbus-openrc')
  optdepends=('avahi-openrc: avahi initscripts')
  install=cups.install

  install -Dm755 "${srcdir}/${_Icups}" "${pkgdir}/etc/init.d/cupsd"

  local _p1='s|lp:lpadmin|daemon:sys|' \
	_p2='s|@neededservices@|need dbus avahi-daemon|'
  sed -e "${_shebang}" -e "${_binpath}" -e "${_p1}" -e "${_p2}" -i "${pkgdir}/etc/init.d/cupsd"
}

package_fcron-openrc() {
  pkgdesc="OpenRC fcron init script"
  depends=('openrc-core' 'fcron')
  groups=('openrc-misc')
  provides=('openrc-cron')
  conflicts=('cronie'
	    'cronie-openrc'
	    'openrc'
	    'openrc-git'
	    'openrc-arch-services-git'
	    'initscripts'
	    'systemd-sysvcompat')
  install=fcron.install

  install -Dm755 "${srcdir}/${_Ifrcon}" "${pkgdir}/etc/init.d/fcron"

  local _p1='s|/usr/libexec|/usr/bin|g'
  sed -e "${_shebang}" -e "${_runpath}" -e "${_p1}" -i "${pkgdir}/etc/init.d/fcron"
}

package_ntp-openrc() {
  pkgdesc="OpenRC ntp init script"
  depends=('openrc-core' 'ntp')
  optdepends=('bind-openrc: bind initscript')
  provides=('openrc-timed')
  conflicts=('openntpd'
	    'openntpd-openrc'
	    'openrc'
	    'openrc-git'
	    'openrc-arch-services-git'
	    'initscripts'
	    'systemd-sysvcompat')
  backup=('etc/conf.d/ntpd'
	  'etc/conf.d/ntp-client'
	  'etc/init.d/sntp')
  install=ntp.install

  install -Dm755 "${srcdir}/${_Cntp1}" "${pkgdir}/etc/conf.d/ntpd"
  install -Dm755 "${srcdir}/${_Intp1}" "${pkgdir}/etc/init.d/ntpd"
  install -Dm755 "${srcdir}/${_Cntp2}" "${pkgdir}/etc/conf.d/ntp-client"
  install -Dm755 "${srcdir}/${_Intp2}" "${pkgdir}/etc/init.d/ntp-client"
  install -Dm755 "${srcdir}/${_Cntp3}" "${pkgdir}/etc/conf.d/sntp"
  install -Dm755 "${srcdir}/${_Intp3}" "${pkgdir}/etc/init.d/sntp"

  for f in ${pkgdir}/etc/init.d/*;do
    sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i $f
  done
}

package_rsyslog-openrc() {
  pkgdesc="OpenRC rsyslog init script"
  depends=('openrc-core' 'rsyslog')
  backup=('etc/conf.d/rsyslog')
  install=rsyslog.install

  install -Dm755 "${srcdir}/${_Crsysl}" "${pkgdir}/etc/conf.d/rsyslog"
  install -Dm755 "${srcdir}/${_Irsysl}" "${pkgdir}/etc/init.d/rsyslog"

  sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/rsyslog"
}

package_sane-openrc() {
  pkgdesc="OpenRC sane init script"
  depends=('openrc-core' 'sane')
  backup=('etc/conf.d/saned')
  install=sane.install

  install -Dm755 "${srcdir}/${_Csane}" "${pkgdir}/etc/conf.d/saned"
  install -Dm755 "${srcdir}/${_Isane}" "${pkgdir}/etc/init.d/saned"

  sed -e "${_shebang}" -e "${_runpath}" -e "${_binpath}" -i ${pkgdir}/etc/init.d/saned
}

package_fuse-openrc(){
  pkgdesc="OpenRC fuse init script"
  depends=('openrc-core' 'fuse')
  install=fuse.install

  install -Dm755 "${srcdir}/${_Ifuse}" "${pkgdir}/etc/init.d/fuse"
  sed -e "${_shebang}" -i "${pkgdir}/etc/init.d/fuse"
}

package_metalog-openrc() {
  pkgdesc="OpenRC metalog init script"
  depends=('openrc-core' 'metalog')
  backup=('etc/conf.d/metalog')
  install=metalog.install

  install -Dm755 "${srcdir}/${_Cmeta}" "${pkgdir}/etc/conf.d/metalog"
  install -Dm755 "${srcdir}/${_Imeta}" "${pkgdir}/etc/init.d/metalog"

  sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/metalog"
}

package_syslog-ng-openrc() {
  pkgdesc="OpenRC syslog-ng init script"
  depends=('openrc-core' 'syslog-ng')
  backup=('etc/conf.d/syslog-ng')
  install=syslog-ng.install

  install -Dm755 "${srcdir}/${_Csyslog}" "${pkgdir}/etc/conf.d/syslog-ng"
  install -Dm755 "${srcdir}/${_Isyslog}" "${pkgdir}/etc/init.d/syslog-ng"

  sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/syslog-ng"
}

package_lm_sensors-openrc() {
  pkgdesc="OpenRC lm_sensors init script"
  depends=('openrc-core' 'lm_sensors')
  #backup=('etc/conf.d/sensord')
  install=lm_sensors.install

  #install -Dm755 "${srcdir}/${_Csens}" "${pkgdir}/etc/conf.d/sensord"
  install -Dm755 "${srcdir}/${_Isens1}" "${pkgdir}/etc/init.d/sensord"
  install -Dm755 "${srcdir}/${_Isens2}" "${pkgdir}/etc/init.d/fancontrol"
  install -Dm755 "${srcdir}/${_Isens3}" "${pkgdir}/etc/init.d/lm_sensors"

  for f in ${pkgdir}/etc/init.d/*; do
    sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i $f
  done
}

package_lirc-utils-openrc() {
  pkgdesc="OpenRC lirc-utils init script"
  depends=('openrc-core' 'lirc-utils')
  backup=('etc/conf.d/lircd'
	  'etc/conf.d/irexec')
  install=lirc-utils.install

  install -Dm755 "${srcdir}/${_Clirc1}" "${pkgdir}/etc/conf.d/lircd"
  install -Dm755 "${srcdir}/${_Ilirc1}" "${pkgdir}/etc/init.d/lircd"

  install -Dm755 "${srcdir}/${_Clirc2}" "${pkgdir}/etc/conf.d/irexec"
  install -Dm755 "${srcdir}/${_Ilirc2}" "${pkgdir}/etc/init.d/irexec"

  install -Dm755 "${srcdir}/${_Ilirc3}" "${pkgdir}/etc/init.d/lircmd"

  for f in ${pkgdir}/etc/init.d/*;do
    sed -e "${_shebang}" -e "${_binpath}" -e "${_runpath}" -i $f
  done
}

package_haveged-openrc() {
  pkgdesc="OpenRC haveged init script"
  depends=('openrc-core' 'haveged')
  backup=('etc/conf.d/haveged')
  install=haveged.install

  install -Dm755 "${srcdir}/${_Chaveg}" "${pkgdir}/etc/conf.d/haveged"
  install -Dm755 "${srcdir}/${_Ihaveg}" "${pkgdir}/etc/init.d/haveged"

  sed -e "${_shebang}" -e "${_binpath}" -i "${pkgdir}/etc/init.d/haveged"
}

package_salt-openrc() {
  pkgdesc="OpenRC salt init scripts"
  depends=('openrc-core' 'salt')
  backup=('etc/conf.d/salt-master'
  		'etc/conf.d/salt-minion'
  		'etc/conf.d/salt-syncdic')
  install=salt.install

  install -Dm755 "${srcdir}/${_Csalt_mtr}" "${pkgdir}/etc/conf.d/salt-master"
  install -Dm755 "${srcdir}/${_Isalt_mtr}" "${pkgdir}/etc/init.d/salt-master"

  install -Dm755 "${srcdir}/${_Csalt_min}" "${pkgdir}/etc/conf.d/salt-minion"
  install -Dm755 "${srcdir}/${_Isalt_min}" "${pkgdir}/etc/init.d/salt-minion"

  install -Dm755 "${srcdir}/${_Csalt_sync}" "${pkgdir}/etc/conf.d/salt-syncdic"
  install -Dm755 "${srcdir}/${_Isalt_sync}" "${pkgdir}/etc/init.d/salt-syncdic"

	for f in ${pkgdir}/etc/init.d/*;do
  		sed -e "${_shebang}" -e "${_runpath}" -i $f
  	done

}

package_mpd-openrc(){
  pkgdesc="OpenRC fuse init script"
  depends=('openrc-core' 'mpd')
  install=mpd.install

  install -Dm755 "${srcdir}/${_Impd}" "${pkgdir}/etc/init.d/mpd"
  sed -e "${_shebang}" -i "${pkgdir}/etc/init.d/mpd"
}

