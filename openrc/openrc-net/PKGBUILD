# Maintainer: artoo <flower_of_life@gmx.net>

# file vars for easy update
_Cbind=named.confd-r7
_Ibind=named.init-r13
_Cbit=bitlbee.confd
_Ibit=bitlbee.initd
_Cblue=rfcomm-conf.d
_Iblue1=rfcomm-init.d
_Iblue2=bluetooth-init.d-r3
_Isasl=saslauthd2.rc7
_Cdhcp1=dhcpd.conf2
_Cdhcp2=dhcrelay.conf
_Cdhcp3=dhcrelay6.conf
_Idhcp1=dhcpd.init5
_Idhcp2=dhcrelay.init3
_Chost=hostapd-conf.d
_Ihost=hostapd-init.d
_Cip1=iptables-1.4.13.confd
_Cip2=ip6tables-1.4.13.confd
_Iip=iptables-1.4.13-r1.init
_Ikrb1=mit-krb5kadmind.initd-r1
_Ikrb2=mit-krb5kdc.initd-r1
_Ikrb3=mit-krb5kpropd.initd-r1
_Clight=lighttpd.confd
_Ilight=lighttpd.initd
_Cnfs=nfs.confd
_Infs1=nfs.initd
_Infs2=nfsmount.initd
_Infs3=rpc.gssd.initd
_Infs4=rpc.idmapd.initd
_Infs5=rpc.pipefs.initd
_Infs6=rpc.statd.initd
_Infs7=rpc.svcgssd.initd
_Cldap=slapd-confd-2.4.28-r1
_Ildap=slapd-initd-2.4.28-r1
_Islp=slpd-init
_Cssh=sshd.confd
_Issh=sshd.rc6.4
_Ipolip=polipo.initd
_Ipostfix=postfix.rc6.2.7
_Ipriv=privoxy.initd
_Cquota=quota.confd
_Iquota1=quota.rc7
_Iquota2=rpc.rquotad.initd
_Crpc=rpcbind.confd
_Irpc=rpcbind.initd
_Crsync=rsyncd.conf.d
_Irsync=rsyncd.init.d-r1
_Csmb=samba4.confd
_Ismb=samba4.initd-r1
_Csquid=squid.confd-r1
_Isquid=squid.initd-r4
_Ctrans=transmission-daemon.confd.4
_Itrans=transmission-daemon.initd.9
_Cufw=ufw.confd
_Iufw=ufw-2.initd
_Ivsftp=vsftpd.init
_Svsftp=vsftpd-checkconfig.sh
_Cwpa=wpa_supplicant-conf.d
_Iwpa=wpa_supplicant-init.d
_Swpa=wpa_cli.sh
_Cxinet=xinetd.confd
_Ixinet=xinetd.rc6
_Cypbind=ypbind.confd-r1
_Iypbind=ypbind.initd
_Cypserv1=ypserv.confd
_Cypserv2=rpc.yppasswdd.confd
_Cypserv3=rpc.ypxfrd.confd
_Iypserv1=ypserv
_Iypserv2=rpc.yppasswdd-r1
_Iypserv3=rpc.ypxfrd-2.23
_Iautofs=autofs5.initd
_Cvpn=openvpn-2.1.conf
_Ivpn=openvpn-2.1.init
_Cntp=openntpd.conf.d-20080406-r6
_Intp=openntpd.init.d-20080406-r6
_Ctor=tor.confd
_Itor=tor.initd-r6

_apver=2.4.4
_aprel=20130801

_dev_uri="http://dev.gentoo.org/~kensington/dist/apache"
_gentoo_uri="http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86"

pkgbase=openrc-net
pkgname=('autofs-openrc'
	'apache-openrc'
	'bind-openrc'
	'bitlbee-openrc'
	'bluez-openrc'
	'cyrus-sasl-openrc'
	'dhcp-openrc'
	'hostapd-openrc'
	'iptables-openrc'
	'krb5-openrc'
	'lighttpd-openrc'
	'nfs-utils-openrc'
	'openldap-openrc'
	'openslp-openrc'
	'openssh-openrc'
	'openntpd-openrc'
	'openvpn-openrc'
	'polipo-openrc'
	'postfix-openrc'
	'privoxy-openrc'
	'quota-tools-openrc'
	'rpcbind-openrc'
	'rsync-openrc'
	'samba-openrc'
	'squid-openrc'
	'transmission-openrc'
	'ufw-openrc'
	'vsftpd-openrc'
	'wpa_supplicant-openrc'
	'xinetd-openrc'
	'ypbind-mt-openrc'
	'ypserv-openrc'
	'tor-openrc')
pkgver=20140612
pkgrel=1
pkgdesc="OpenRC init scripts"
arch=('any')
url="https://github.com/udeved/pkgbuilds"
license=('GPL2')
groups=('openrc' 'openrc-net')
conflicts=('openrc'
	  'openrc-git'
	  'openrc-arch-services-git'
	  'initscripts'
	  'systemd-sysvcompat')
source=("${_dev_uri}/gentoo-apache-${_apver}-${_aprel}.tar.bz2"
	"${_gentoo_uri}/net-dns/bind/files/${_Cbind}"
	"${_gentoo_uri}/net-dns/bind/files/${_Ibind}"
	"${_gentoo_uri}/net-im/bitlbee/files/${_Cbit}"
	"${_gentoo_uri}/net-im/bitlbee/files/${_Ibit}"
	"${_gentoo_uri}/net-wireless/bluez/files/${_Cblue}"
	"${_gentoo_uri}/net-wireless/bluez/files/${_Iblue1}"
	"${_gentoo_uri}/net-wireless/bluez/files/${_Iblue2}"
	"${_gentoo_uri}/dev-libs/cyrus-sasl/files/${_Isasl}"
	"${_gentoo_uri}/net-misc/dhcp/files/${_Cdhcp1}"
	"${_gentoo_uri}/net-misc/dhcp/files/${_Cdhcp2}"
	"${_gentoo_uri}/net-misc/dhcp/files/${_Cdhcp3}"
	"${_gentoo_uri}/net-misc/dhcp/files/${_Idhcp1}"
	"${_gentoo_uri}/net-misc/dhcp/files/${_Idhcp2}"
	"${_gentoo_uri}/net-wireless/hostapd/files/${_Chost}"
	"${_gentoo_uri}/net-wireless/hostapd/files/${_Ihost}"
	"${_gentoo_uri}/net-firewall/iptables/files/${_Cip1}"
	"${_gentoo_uri}/net-firewall/iptables/files/${_Cip2}"
	"${_gentoo_uri}/net-firewall/iptables/files/${_Iip}"
	"${_gentoo_uri}/app-crypt/mit-krb5/files/${_Ikrb1}"
	"${_gentoo_uri}/app-crypt/mit-krb5/files/${_Ikrb2}"
	"${_gentoo_uri}/app-crypt/mit-krb5/files/${_Ikrb3}"
	"${_gentoo_uri}/www-servers/lighttpd/files/${_Clight}"
	"${_gentoo_uri}/www-servers/lighttpd/files/${_Ilight}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Cnfs}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs1}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs2}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs3}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs4}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs5}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs6}"
	"${_gentoo_uri}/net-fs/nfs-utils/files/${_Infs7}"
	"${_gentoo_uri}/net-nds/openldap/files/${_Cldap}"
	"${_gentoo_uri}/net-nds/openldap/files/${_Ildap}"
	"${_gentoo_uri}/net-libs/openslp/files/${_Islp}"
	"${_gentoo_uri}/net-misc/openssh/files/${_Cssh}"
	"${_gentoo_uri}/net-misc/openssh/files/${_Issh}"
	"${_gentoo_uri}/net-proxy/polipo/files/${_Ipolip}"
	"${_gentoo_uri}/mail-mta/postfix/files/${_Ipostfix}"
	"${_gentoo_uri}/net-proxy/privoxy/files/${_Ipriv}"
	"${_gentoo_uri}/sys-fs/quota/files/${_Cquota}"
	"${_gentoo_uri}/sys-fs/quota/files/${_Iquota1}"
	"${_gentoo_uri}/sys-fs/quota/files/${_Iquota2}"
	"${_gentoo_uri}/net-nds/rpcbind/files/${_Crpc}"
	"${_gentoo_uri}/net-nds/rpcbind/files/${_Irpc}"
	"${_gentoo_uri}/net-misc/rsync/files/${_Crsync}"
	"${_gentoo_uri}/net-misc/rsync/files/${_Irsync}"
	"${_gentoo_uri}/net-fs/samba/files/4.1/${_Csmb}"
	"${_gentoo_uri}/net-fs/samba/files/4.1/${_Ismb}"
	"${_gentoo_uri}/net-proxy/squid/files/${_Csquid}"
	"${_gentoo_uri}/net-proxy/squid/files/${_Isquid}"
	"${_gentoo_uri}/net-p2p/transmission/files/${_Ctrans}"
	"${_gentoo_uri}/net-p2p/transmission/files/${_Itrans}"
	"${_gentoo_uri}/net-firewall/ufw/files/${_Cufw}"
	"${_gentoo_uri}/net-firewall/ufw/files/${_Iufw}"
	"${_gentoo_uri}/net-ftp/vsftpd/files/${_Ivsftp}"
	"${_gentoo_uri}/net-ftp/vsftpd/files/${_Svsftp}"
	"${_gentoo_uri}/net-wireless/wpa_supplicant/files/${_Cwpa}"
	"${_gentoo_uri}/net-wireless/wpa_supplicant/files/${_Iwpa}"
	"${_gentoo_uri}/net-wireless/wpa_supplicant/files/${_Swpa}"
	"${_gentoo_uri}/sys-apps/xinetd/files/${_Cxinet}"
	"${_gentoo_uri}/sys-apps/xinetd/files/${_Ixinet}"
	"${_gentoo_uri}/net-nds/ypbind/files/${_Cypbind}"
	"${_gentoo_uri}/net-nds/ypbind/files/${_Iypbind}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Cypserv1}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Cypserv2}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Cypserv3}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Iypserv1}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Iypserv2}"
	"${_gentoo_uri}/net-nds/ypserv/files/${_Iypserv3}"
	"${_gentoo_uri}/net-fs/autofs/files/${_Iautofs}"
	"${_gentoo_uri}/net-misc/openvpn/files/${_Cvpn}"
	"${_gentoo_uri}/net-misc/openvpn/files/${_Ivpn}"
	"${_gentoo_uri}/net-misc/openntpd/files/${_Cntp}"
	"${_gentoo_uri}/net-misc/openntpd/files/${_Intp}"
	"${_gentoo_uri}/net-misc/tor/files/${_Ctor}"
	"${_gentoo_uri}/net-misc/tor/files/${_Itor}")

pkgver() {
  date +%Y%m%d
}

_shebang='s|#!/sbin/runscript|#!/usr/bin/runscript|'
_runpath='s|/var/run|/run|g'
_binpath=('s|/usr/sbin|/usr/bin|g' 's|/sbin|/usr/bin|g')

package_apache-openrc() {
  pkgdesc="OpenRC apache init script"
  depends=('openrc-core' 'apache')
  backup=('etc/conf.d/httpd')
  install=apache.install

  install -Dm755 "${srcdir}/gentoo-apache-${_apver}/init/apache2.confd" "${pkgdir}/etc/conf.d/httpd"
  install -Dm755 "${srcdir}/gentoo-apache-${_apver}/init/apache2.initd" "${pkgdir}/etc/init.d/httpd"

  local _p1='s|/usr/sbin/apache2|/usr/bin/apachectl|' \
	_p2='s|/etc/apache2/httpd.conf|/etc/httpd/conf/httpd.conf|' \
	_p3='s/! test -f/test -f/' \
	_p4='s|/usr/lib/apache2|/usr/lib/httpd|' \
	_p5='s|apache2.pid|httpd/httpd.pid|' \
	_p6='s|apache2 >/dev/null|httpd >/dev/null|' \
	_p7='s|apache2|httpd|g' \
	_p8='s|/run/apache_ssl_mutex|/run/httpd|'
  sed -e "${_shebang}" -e "${_p1}" -e "${_p2}" -e "${_p3}" \
      -e "${_p4}" -e "${_p5}" -e "${_p6}" -e "${_p8}" -i "${pkgdir}/etc/init.d/httpd"
  sed -e "${_p2}" -e "${_p4}" -e "${_p5}" -e "${_p7}" -i "${pkgdir}/etc/conf.d/httpd"
}

package_autofs-openrc() {
  pkgdesc="OpenRC autofs init script"
  depends=('openrc-core' 'autofs')
  install=autofs.install

  install -Dm755 "${srcdir}/${_Iautofs}" "${pkgdir}/etc/init.d/autofs"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/autofs"
}

package_bind-openrc() {
  pkgdesc="OpenRC bind init script"
  depends=('openrc-core' 'bind')
  backup=('etc/conf.d/named')
  install=bind.install

  install -Dm755 "${srcdir}/${_Cbind}" "${pkgdir}/etc/conf.d/named"
  install -Dm755 "${srcdir}/${_Ibind}" "${pkgdir}/etc/init.d/named"

  local _p1='s|/etc/bind/named.conf|/etc/named.conf|g'
  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -i "${pkgdir}/etc/init.d/named"
}

package_bitlbee-openrc() {
  pkgdesc="OpenRC bitlbee init script"
  depends=('openrc-core' 'bitlbee')
  backup=('etc/conf.d/bitlbee')
  install=bitlbee.install

  install -Dm755 "${srcdir}/${_Cbit}" "${pkgdir}/etc/conf.d/bitlbee"
  install -Dm755 "${srcdir}/${_Ibit}" "${pkgdir}/etc/init.d/bitlbee"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/bitlbee"
}

package_bluez-openrc() {
  pkgdesc="OpenRC bluez init script"
  depends=('bluez' 'dbus-openrc')
  backup=('etc/conf.d/rfcomm')
  install=bluez.install

  install -Dm755 "${srcdir}/${_Cblue}" "${pkgdir}/etc/conf.d/rfcomm"
  install -Dm755 "${srcdir}/${_Iblue1}" "${pkgdir}/etc/init.d/rfcomm"
  install -Dm755 "${srcdir}/${_Iblue2}" "${pkgdir}/etc/init.d/bluetooth"

  local _p1='s|/usr/sbin|/usr/lib/bluetooth|g'
  sed -e "${_shebang}" -e "${_p1}" -i "${pkgdir}/etc/init.d/bluetooth"
  sed -e "${_shebang}" -e "${_binpath[0]}" -i "${pkgdir}/etc/init.d/rfcomm"
}

package_cyrus-sasl-openrc() {
  pkgdesc="OpenRC cyrus-sasl init script"
  depends=('openrc-core' 'cyrus-sasl')
  install=cyrus-sasl.install

  install -Dm755 "${srcdir}/${_Isasl}" "${pkgdir}/etc/init.d/saslauthd"

  sed -e "${_shebang}" -e "${_binpath[0]}" -i "${pkgdir}/etc/init.d/saslauthd"
}

package_dhcp-openrc() {
  pkgdesc="OpenRC dhcp init script"
  depends=('openrc-core' 'dhcp')
  optdepends=('openldap-openrc: openldap initscript'
	      'bind-openrc: bind initscript')
  backup=('etc/conf.d/dhcpd'
	  'etc/conf.d/dhcrelay'
	  'etc/conf.d/dhcrelay6')
  install=dhcp.install

  install -Dm755 "${srcdir}/${_Cdhcp1}" "${pkgdir}/etc/conf.d/dhcpd"
  install -Dm755 "${srcdir}/${_Cdhcp2}" "${pkgdir}/etc/conf.d/dhcrelay"
  install -Dm755 "${srcdir}/${_Cdhcp3}" "${pkgdir}/etc/conf.d/dhcrelay6"

  install -Dm755 "${srcdir}/${_Idhcp1}" "${pkgdir}/etc/init.d/dhcpd"
  install -Dm755 "${srcdir}/${_Idhcp2}" "${pkgdir}/etc/init.d/dhcrelay"
  install -Dm755 "${srcdir}/${_Idhcp2}" "${pkgdir}/etc/init.d/dhcrelay6"

  local _p1='s|#@slapd@|ldap slapd|'
  for f in ${pkgdir}/etc/init.d/*;do
    sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}"  -e "${_p1}" -i $f
  done
}

package_hostapd-openrc() {
  pkgdesc="OpenRC hostapd init script"
  depends=('openrc-core' 'hostapd')
  backup=('etc/conf.d/hostapd')
  install=hostapd.install

  install -Dm755 "${srcdir}/${_Chost}" "${pkgdir}/etc/conf.d/hostapd"
  install -Dm755 "${srcdir}/${_Ihost}" "${pkgdir}/etc/init.d/hostapd"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/hostapd"
}

package_iptables-openrc() {
  pkgdesc="OpenRC iptables init script"
  depends=('openrc-core' 'iptables')
  backup=('etc/conf.d/iptables'
	  'etc/conf.d/ip6tables')
  install=iptables.install

  install -Dm755 "${srcdir}/${_Cip1}" "${pkgdir}/etc/conf.d/iptables"
  install -Dm755 "${srcdir}/${_Iip}" "${pkgdir}/etc/init.d/iptables"
  install -Dm755 "${srcdir}/${_Cip2}" "${pkgdir}/etc/conf.d/ip6tables"
  install -Dm755 "${srcdir}/${_Iip}" "${pkgdir}/etc/init.d/ip6tables"

  for f in ${pkgdir}/etc/init.d/*;do
    sed -e "${_shebang}" -e "${_binpath[1]}" -e "${_runpath}" -i $f
  done
}

package_krb5-openrc() {
  pkgdesc="OpenRC krb5 init script"
  depends=('openrc-core' 'krb5')
  install=krb5.install

  install -Dm755 "${srcdir}/${_Ikrb1}" "${pkgdir}/etc/init.d/krb5kadmind"
  install -Dm755 "${srcdir}/${_Ikrb2}" "${pkgdir}/etc/init.d/krb5kdc"
  install -Dm755 "${srcdir}/${_Ikrb3}" "${pkgdir}/etc/init.d/krb5kpropd"

  local _p1='s|mit-krb5kdc|krb5kdc|g' \
	_p2='s|mit-krb5kadmind|krb5kadmind|g'
  for f in ${pkgdir}/etc/init.d/*;do
    sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -e "${_p2}" -i $f
  done
}

package_lighttpd-openrc() {
  pkgdesc="OpenRC lighttpd init script"
  depends=('openrc-core' 'lighttpd')
  backup=('etc/conf.d/lighttpd')
  install=lighttpd.install

  install -Dm755 "${srcdir}/${_Clight}" "${pkgdir}/etc/conf.d/lighttpd"
  install -Dm755 "${srcdir}/${_Ilight}" "${pkgdir}/etc/init.d/lighttpd"
  local _p1='s/lighttpd:lighttpd/http:http/'
  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e ${_p1} -i "${pkgdir}/etc/init.d/lighttpd"
}

package_rpcbind-openrc() {
  pkgdesc="OpenRC rpcbind init script"
  depends=('openrc-core' 'rpcbind')
  backup=('etc/conf.d/rpcbind')
  install=rpcbind.install

  install -Dm755 "${srcdir}/${_Crpc}" "${pkgdir}/etc/conf.d/rpcbind"
  install -Dm755 "${srcdir}/${_Irpc}" "${pkgdir}/etc/init.d/rpcbind"

  sed -e "${_shebang}" -e "${_binpath[1]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/rpcbind"
}

package_nfs-utils-openrc() {
  pkgdesc="OpenRC nfs-utils init script"
  depends=('nfs-utils' 'rpcbind-openrc' 'device-mapper-openrc')
  optdepends=('ypbind-openrc: ypbind initscript'
	      'quota-tools-openrc: quota-tools initscript'
	      'bind-openrc: bind initscript')
  backup=('etc/conf.d/nfs')
  install=nfs-utils.install

  install -Dm755 "${srcdir}/${_Cnfs}" "${pkgdir}/etc/conf.d/nfs"

  install -Dm755 "${srcdir}/${_Infs1}" "${pkgdir}/etc/init.d/nfs"
  install -Dm755 "${srcdir}/${_Infs2}" "${pkgdir}/etc/init.d/nfsmount"
  install -Dm755 "${srcdir}/${_Infs3}" "${pkgdir}/etc/init.d/rpc.gssd"
  install -Dm755 "${srcdir}/${_Infs4}" "${pkgdir}/etc/init.d/rpc.idmapd"
  install -Dm755 "${srcdir}/${_Infs5}" "${pkgdir}/etc/init.d/rpc.pipefs"
  install -Dm755 "${srcdir}/${_Infs6}" "${pkgdir}/etc/init.d/rpc.statd"
  install -Dm755 "${srcdir}/${_Infs7}" "${pkgdir}/etc/init.d/rpc.svcgssd"

  for f in ${pkgdir}/etc/init.d/*;do
    sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i $f
  done
}

package_openntpd-openrc() {
  pkgdesc="OpenRC openntpd init script"
  depends=('openrc-core' 'openntpd')
  groups=('openrc-net')
  provides=('openrc-timed')
  conflicts=('ntp'
	    'ntp-openrc'
	    'openrc'
	    'openrc-git'
	    'openrc-arch-services-git'
	    'initscripts'
	    'systemd-sysvcompat')
  backup=('etc/conf.d/ntpd')
  install=openntpd.install

  install -Dm755 "${srcdir}/${_Cntp}" "${pkgdir}/etc/conf.d/ntpd"
  install -Dm755 "${srcdir}/${_Intp}" "${pkgdir}/etc/init.d/ntpd"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/ntpd"
}

package_openldap-openrc() {
  pkgdesc="OpenRC openldap init script"
  depends=('openrc-core' 'openldap')
  backup=('etc/conf.d/slapd')
  install=openldap.install

  install -Dm755 "${srcdir}/${_Cldap}" "${pkgdir}/etc/conf.d/slapd"
  install -Dm755 "${srcdir}/${_Ildap}" "${pkgdir}/etc/init.d/slapd"

  local _p1='s|/usr/lib/openldap/slapd|/usr/lib/slapd|g'
  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -i "${pkgdir}/etc/init.d/slapd"
}

package_openslp-openrc() {
  pkgdesc="OpenRC openslp init script"
  depends=('openrc-core' 'openslp')
  install=openslp.install

  install -Dm755 "${srcdir}/${_Islp}" "${pkgdir}/etc/init.d/slpd"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/slpd"
}

package_openssh-openrc() {
  pkgdesc="OpenRC openssh init script"
  depends=('openrc-core' 'openssh')
  optdepends=('bind-openrc: bind initscript')
  backup=('etc/conf.d/sshd')
  install=openssh.install

  install -Dm755 "${srcdir}/${_Cssh}" "${pkgdir}/etc/conf.d/sshd"
  install -Dm755 "${srcdir}/${_Issh}" "${pkgdir}/etc/init.d/sshd"

  sed -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/conf.d/sshd"
  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/sshd"
}

package_openvpn-openrc() {
  pkgdesc="OpenRC openvpn init script"
  depends=('openrc-core' 'openvpn')
  backup=('etc/conf.d/openvpn')
  install=openvpn.install

  install -Dm755 "${srcdir}/${_Cvpn}" "${pkgdir}/etc/conf.d/openvpn"
  install -Dm755 "${srcdir}/${_Ivpn}" "${pkgdir}/etc/init.d/openvpn"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/openvpn"
}

package_polipo-openrc() {
  pkgdesc="OpenRC polipo init script"
  depends=('openrc-core' 'polipo')
  install=polipo.install

  install -Dm755 "${srcdir}/${_Ipolip}" "${pkgdir}/etc/init.d/polipo"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/polipo"
}

package_postfix-openrc() {
  pkgdesc="OpenRC postfix init script"
  depends=('openrc-core' 'postfix')
  optdepends=('bind-openrc: bind initscript'
	      'ypbind-openrc: ypbind initscript'
	      'cyrus-sasl-openrc: cyrus-sasl initscript')
  install=postfix.install

  install -Dm755 "${srcdir}/${_Ipostfix}" "${pkgdir}/etc/init.d/postfix"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/postfix"
}

package_privoxy-openrc() {
  pkgdesc="OpenRC privoxy init script"
  depends=('openrc-core' 'privoxy')
  install=privoxy.install

  install -Dm755 "${srcdir}/${_Ipriv}" "${pkgdir}/etc/init.d/privoxy"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/privoxy"
}

package_quota-tools-openrc() {
  pkgdesc="OpenRC quota-tools init script"
  depends=('quota-tools' 'rpcbind-openrc')
  optdepends=('ypbind-openrc: ypbind initscript')
  backup=('etc/conf.d/quota')
  install=quota-tools.install

  install -Dm755 "${srcdir}/${_Cquota}" "${pkgdir}/etc/conf.d/quota"
  install -Dm755 "${srcdir}/${_Iquota1}" "${pkgdir}/etc/init.d/quota"
  install -Dm755 "${srcdir}/${_Iquota2}" "${pkgdir}/etc/init.d/rpc.rquotad"


  for f in ${pkgdir}/etc/init.d/*;do
    sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i $f
  done
}

package_rsync-openrc() {
  pkgdesc="OpenRC rsync init script"
  depends=('openrc-core' 'rsync')
  backup=('etc/conf.d/rsyncd')
  install=rsync.install

  install -Dm755 "${srcdir}/${_Crsync}" "${pkgdir}/etc/conf.d/rsyncd"
  install -Dm755 "${srcdir}/${_Irsync}" "${pkgdir}/etc/init.d/rsyncd"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/rsyncd"
}

package_samba-openrc() {
  pkgdesc="OpenRC samba init script"
  depends=('openrc-core' 'samba')
  backup=('etc/conf.d/smb')
  install=samba.install

  install -Dm755 "${srcdir}/${_Csmb}" "${pkgdir}/etc/conf.d/smb"
  install -Dm755 "${srcdir}/${_Ismb}" "${pkgdir}/etc/init.d/smb"

  local _p1='s/="samba"/="smb"/'
  sed -e "${_binpath[0]}" -e ${_p1} -i "${pkgdir}/etc/conf.d/smb"

  _p1='s/##samba/##smb/'
  local _p2='s|"samba"|"smb"|'
  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e ${_p1} -e ${_p2} -i "${pkgdir}/etc/init.d/smb"
}

package_squid-openrc() {
  pkgdesc="OpenRC squid init script"
  depends=('openrc-core' 'squid')
  optdepends=('bind-openrc: bind initscript')
  backup=('etc/conf.d/squid')
  install=squid.install

  install -Dm755 "${srcdir}/${_Csquid}" "${pkgdir}/etc/conf.d/squid"
  install -Dm755 "${srcdir}/${_Isquid}" "${pkgdir}/etc/init.d/squid"

  local _p1='s|chown squid|chown proxy|' \
	_p2='s|squid:squid|proxy:proxy|'
  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -e "${_p2}" -i "${pkgdir}/etc/init.d/squid"
}

package_transmission-openrc() {
  pkgdesc="OpenRC transmission init script"
  depends=('openrc-core' 'transmission-cli')
  backup=('etc/conf.d/transmission-daemon')
  install=transmission.install

  install -Dm755 "${srcdir}/${_Ctrans}" "${pkgdir}/etc/conf.d/transmission-daemon"
  install -Dm755 "${srcdir}/${_Itrans}" "${pkgdir}/etc/init.d/transmission-daemon"

  sed -e "${_shebang}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/transmission-daemon"
}

package_ufw-openrc() {
  pkgdesc="OpenRC ufw init script"
  depends=('openrc-core' 'ufw')
  backup=('etc/conf.d/ufw')
  install=ufw.install

  install -Dm755 "${srcdir}/${_Cufw}" "${pkgdir}/etc/conf.d/ufw"
  install -Dm755 "${srcdir}/${_Iufw}" "${pkgdir}/etc/init.d/ufw"

  local _p1='s|/usr/share/ufw/ufw-init-functions|/usr/lib/ufw/ufw-init-functions|g'
  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -i "${pkgdir}/etc/init.d/ufw"
}

package_vsftpd-openrc() {
  pkgdesc="OpenRC vsftpd init script"
  depends=('openrc-core' 'vsftpd')
  optdepends=('bind-openrc: bind initscript')
  install=vsftpd.install

  install -Dm755 "${srcdir}/${_Ivsftp}" "${pkgdir}/etc/init.d/vsftpd"
  install -Dm755 "${srcdir}/${_Svsftp}" "${pkgdir}/usr/lib/vsftpd-checkconfig.sh"

  local _p1='s|/usr/libexec/|/usr/lib/|g' \
	_p2='s|/etc/vsftpd/|/etc/|g'
  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -e "${_p1}" -e "${_p2}" -i "${pkgdir}/etc/init.d/vsftpd"
  sed -e "${_p2}" -i "${pkgdir}/usr/lib/vsftpd-checkconfig.sh"
}

package_wpa_supplicant-openrc() {
  pkgdesc="OpenRC wpa_supplicant init script"
  depends=('openrc-core' 'wpa_supplicant')
  backup=('etc/conf.d/wpa_supplicant')
  install=wpa_supplicant.install

  install -Dm755 "${srcdir}/${_Cwpa}" "${pkgdir}/etc/conf.d/wpa_supplicant"
  install -Dm755 "${srcdir}/${_Iwpa}" "${pkgdir}/etc/init.d/wpa_supplicant"
  install -Dm755 "${srcdir}/${_Swpa}" "${pkgdir}/etc/wpa_supplicant/wpa_cli.sh"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/wpa_supplicant"
  sed -e 's|gentoo-release|arch-release|' -i "${pkgdir}/etc/wpa_supplicant/wpa_cli.sh"
}

package_xinetd-openrc() {
  pkgdesc="OpenRC xinetd init script"
  depends=('openrc-core' 'xinetd')
  backup=('etc/conf.d/xinetd')
  install=xinetd.install

  install -Dm755 "${srcdir}/${_Cxinet}" "${pkgdir}/etc/conf.d/xinetd"
  install -Dm755 "${srcdir}/${_Ixinet}" "${pkgdir}/etc/init.d/xinetd"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/xinetd"
}

package_ypbind-mt-openrc() {
  pkgdesc="OpenRC ypbind-mt init script"
  depends=('ypbind-mt' 'rpcbind-openrc' 'openslp-openrc')
  optdepends=('ypserv-openrc: ypserv initscript')
  backup=('etc/conf.d/ypbind')
  install=ypbind-mt.install

  install -Dm755 "${srcdir}/${_Cypbind}" "${pkgdir}/etc/conf.d/ypbind"
  install -Dm755 "${srcdir}/${_Iypbind}" "${pkgdir}/etc/init.d/ypbind"

  sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/ypbind"
}

package_ypserv-openrc() {
  pkgdesc="OpenRC ypserv init script"
  depends=('openrc-core' 'ypserv')
  backup=('etc/conf.d/rpc.yppasswdd'
	  'etc/conf.d/rpc.ypxfrd'
	  'etc/conf.d/ypserv')
  install=ypserv.install

  install -Dm755 "${srcdir}/${_Cypserv1}" "${pkgdir}/etc/init.d/ypserv"
  install -Dm755 "${srcdir}/${_Iypserv1}" "${pkgdir}/etc/conf.d/ypserv"
  install -Dm755 "${srcdir}/${_Cypserv2}" "${pkgdir}/etc/conf.d/rpc.yppasswdd"
  install -Dm755 "${srcdir}/${_Iypserv2}" "${pkgdir}/etc/init.d/rpc.yppasswdd"
  install -Dm755 "${srcdir}/${_Cypserv3}" "${pkgdir}/etc/conf.d/rpc.ypxfrd"
  install -Dm755 "${srcdir}/${_Iypserv3}" "${pkgdir}/etc/init.d/rpc.ypxfrd"

  for f in ${pkgdir}/etc/init.d/*;do
    sed -e "${_shebang}" -e "${_binpath[0]}" -e "${_runpath}" -i $f
  done
}

package_tor-openrc() {
  pkgdesc="OpenRC tor init script"
  depends=('openrc-core' 'tor')
  backup=('etc/conf.d/tor')
  install=tor.install

  install -Dm755 "${srcdir}/${_Ctor}" "${pkgdir}/etc/conf.d/tor"
  install -Dm755 "${srcdir}/${_Itor}" "${pkgdir}/etc/init.d/tor"

  sed -e "${_shebang}" -e "${_runpath}" -i "${pkgdir}/etc/init.d/tor"
}
